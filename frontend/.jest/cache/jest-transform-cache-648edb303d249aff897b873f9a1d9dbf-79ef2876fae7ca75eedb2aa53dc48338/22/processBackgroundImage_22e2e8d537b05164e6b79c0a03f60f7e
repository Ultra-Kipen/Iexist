881e7ee6cf6d0a8bf99c8f32a81fe5c7
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = processBackgroundImage;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var processColor = require("./processColor").default;
var DIRECTION_KEYWORD_REGEX = /^to\s+(?:top|bottom|left|right)(?:\s+(?:top|bottom|left|right))?/i;
var ANGLE_UNIT_REGEX = /^([+-]?\d*\.?\d+)(deg|grad|rad|turn)$/i;
var DEFAULT_DIRECTION = {
  type: 'angle',
  value: 180
};
function processBackgroundImage(backgroundImage) {
  var result = [];
  if (backgroundImage == null) {
    return result;
  }
  if (typeof backgroundImage === 'string') {
    result = parseCSSLinearGradient(backgroundImage.replace(/\n/g, ' '));
  } else if (Array.isArray(backgroundImage)) {
    for (var bgImage of backgroundImage) {
      var processedColorStops = [];
      for (var index = 0; index < bgImage.colorStops.length; index++) {
        var colorStop = bgImage.colorStops[index];
        var processedColor = processColor(colorStop.color);
        if (processedColor == null) {
          return [];
        }
        if (colorStop.positions != null && colorStop.positions.length > 0) {
          for (var position of colorStop.positions) {
            if (position.endsWith('%')) {
              processedColorStops.push({
                color: processedColor,
                position: parseFloat(position) / 100
              });
            } else {
              return [];
            }
          }
        } else {
          processedColorStops.push({
            color: processedColor,
            position: null
          });
        }
      }
      var direction = DEFAULT_DIRECTION;
      var bgDirection = bgImage.direction != null ? bgImage.direction.toLowerCase() : null;
      if (bgDirection != null) {
        if (ANGLE_UNIT_REGEX.test(bgDirection)) {
          var parsedAngle = getAngleInDegrees(bgDirection);
          if (parsedAngle != null) {
            direction = {
              type: 'angle',
              value: parsedAngle
            };
          } else {
            return [];
          }
        } else if (DIRECTION_KEYWORD_REGEX.test(bgDirection)) {
          var parsedDirection = getDirectionForKeyword(bgDirection);
          if (parsedDirection != null) {
            direction = parsedDirection;
          } else {
            return [];
          }
        } else {
          return [];
        }
      }
      var fixedColorStops = getFixedColorStops(processedColorStops);
      result = result.concat({
        type: 'linearGradient',
        direction: direction,
        colorStops: fixedColorStops
      });
    }
  }
  return result;
}
function parseCSSLinearGradient(cssString) {
  var gradients = [];
  var match;
  var linearGradientRegex = /linear-gradient\s*\(((?:\([^)]*\)|[^())])*)\)/gi;
  while (match = linearGradientRegex.exec(cssString)) {
    var gradientContent = match[1];
    var parts = gradientContent.split(',');
    var direction = DEFAULT_DIRECTION;
    var trimmedDirection = parts[0].trim().toLowerCase();
    var colorStopRegex = /\s*((?:(?:rgba?|hsla?)\s*\([^)]+\))|#[0-9a-fA-F]+|[a-zA-Z]+)(?:\s+(-?[0-9.]+%?)(?:\s+(-?[0-9.]+%?))?)?\s*/gi;
    if (ANGLE_UNIT_REGEX.test(trimmedDirection)) {
      var parsedAngle = getAngleInDegrees(trimmedDirection);
      if (parsedAngle != null) {
        direction = {
          type: 'angle',
          value: parsedAngle
        };
        parts.shift();
      } else {
        return [];
      }
    } else if (DIRECTION_KEYWORD_REGEX.test(trimmedDirection)) {
      var parsedDirection = getDirectionForKeyword(trimmedDirection);
      if (parsedDirection != null) {
        direction = parsedDirection;
        parts.shift();
      } else {
        return [];
      }
    } else if (!colorStopRegex.test(trimmedDirection)) {
      return [];
    }
    colorStopRegex.lastIndex = 0;
    var colorStops = [];
    var fullColorStopsStr = parts.join(',');
    var colorStopMatch = void 0;
    while (colorStopMatch = colorStopRegex.exec(fullColorStopsStr)) {
      var _colorStopMatch = colorStopMatch,
        _colorStopMatch2 = (0, _slicedToArray2.default)(_colorStopMatch, 4),
        color = _colorStopMatch2[1],
        position1 = _colorStopMatch2[2],
        position2 = _colorStopMatch2[3];
      var processedColor = processColor(color.trim().toLowerCase());
      if (processedColor == null) {
        return [];
      }
      if (typeof position1 !== 'undefined') {
        if (position1.endsWith('%')) {
          colorStops.push({
            color: processedColor,
            position: parseFloat(position1) / 100
          });
        } else {
          return [];
        }
      } else {
        colorStops.push({
          color: processedColor,
          position: null
        });
      }
      if (typeof position2 !== 'undefined') {
        if (position2.endsWith('%')) {
          colorStops.push({
            color: processedColor,
            position: parseFloat(position2) / 100
          });
        } else {
          return [];
        }
      }
    }
    var fixedColorStops = getFixedColorStops(colorStops);
    gradients.push({
      type: 'linearGradient',
      direction: direction,
      colorStops: fixedColorStops
    });
  }
  return gradients;
}
function getDirectionForKeyword(direction) {
  if (direction == null) {
    return null;
  }
  var normalized = direction.replace(/\s+/g, ' ').toLowerCase();
  switch (normalized) {
    case 'to top':
      return {
        type: 'angle',
        value: 0
      };
    case 'to right':
      return {
        type: 'angle',
        value: 90
      };
    case 'to bottom':
      return {
        type: 'angle',
        value: 180
      };
    case 'to left':
      return {
        type: 'angle',
        value: 270
      };
    case 'to top right':
    case 'to right top':
      return {
        type: 'keyword',
        value: 'to top right'
      };
    case 'to bottom right':
    case 'to right bottom':
      return {
        type: 'keyword',
        value: 'to bottom right'
      };
    case 'to top left':
    case 'to left top':
      return {
        type: 'keyword',
        value: 'to top left'
      };
    case 'to bottom left':
    case 'to left bottom':
      return {
        type: 'keyword',
        value: 'to bottom left'
      };
    default:
      return null;
  }
}
function getAngleInDegrees(angle) {
  if (angle == null) {
    return null;
  }
  var match = angle.match(ANGLE_UNIT_REGEX);
  if (!match) {
    return null;
  }
  var _match = (0, _slicedToArray2.default)(match, 3),
    value = _match[1],
    unit = _match[2];
  var numericValue = parseFloat(value);
  switch (unit) {
    case 'deg':
      return numericValue;
    case 'grad':
      return numericValue * 0.9;
    case 'rad':
      return numericValue * 180 / Math.PI;
    case 'turn':
      return numericValue * 360;
    default:
      return null;
  }
}
function getFixedColorStops(colorStops) {
  var _colorStops$0$positio;
  var fixedColorStops = [];
  var hasNullPositions = false;
  var maxPositionSoFar = (_colorStops$0$positio = colorStops[0].position) != null ? _colorStops$0$positio : 0;
  for (var i = 0; i < colorStops.length; i++) {
    var colorStop = colorStops[i];
    var newPosition = colorStop.position;
    if (newPosition === null) {
      if (i === 0) {
        newPosition = 0;
      } else if (i === colorStops.length - 1) {
        newPosition = 1;
      }
    }
    if (newPosition !== null) {
      newPosition = Math.max(newPosition, maxPositionSoFar);
      fixedColorStops[i] = {
        color: colorStop.color,
        position: newPosition
      };
      maxPositionSoFar = newPosition;
    } else {
      hasNullPositions = true;
    }
  }
  if (hasNullPositions) {
    var lastDefinedIndex = 0;
    for (var _i = 1; _i < fixedColorStops.length; _i++) {
      if (fixedColorStops[_i] !== undefined) {
        var unpositionedStops = _i - lastDefinedIndex - 1;
        if (unpositionedStops > 0) {
          var startPosition = fixedColorStops[lastDefinedIndex].position;
          var endPosition = fixedColorStops[_i].position;
          var increment = (endPosition - startPosition) / (unpositionedStops + 1);
          for (var j = 1; j <= unpositionedStops; j++) {
            fixedColorStops[lastDefinedIndex + j] = {
              color: colorStops[lastDefinedIndex + j].color,
              position: startPosition + increment * j
            };
          }
        }
        lastDefinedIndex = _i;
      }
    }
  }
  return fixedColorStops;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZGVmYXVsdCIsInByb2Nlc3NCYWNrZ3JvdW5kSW1hZ2UiLCJfc2xpY2VkVG9BcnJheTIiLCJwcm9jZXNzQ29sb3IiLCJESVJFQ1RJT05fS0VZV09SRF9SRUdFWCIsIkFOR0xFX1VOSVRfUkVHRVgiLCJERUZBVUxUX0RJUkVDVElPTiIsInR5cGUiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJyZXN1bHQiLCJwYXJzZUNTU0xpbmVhckdyYWRpZW50IiwicmVwbGFjZSIsIkFycmF5IiwiaXNBcnJheSIsImJnSW1hZ2UiLCJwcm9jZXNzZWRDb2xvclN0b3BzIiwiaW5kZXgiLCJjb2xvclN0b3BzIiwibGVuZ3RoIiwiY29sb3JTdG9wIiwicHJvY2Vzc2VkQ29sb3IiLCJjb2xvciIsInBvc2l0aW9ucyIsInBvc2l0aW9uIiwiZW5kc1dpdGgiLCJwdXNoIiwicGFyc2VGbG9hdCIsImRpcmVjdGlvbiIsImJnRGlyZWN0aW9uIiwidG9Mb3dlckNhc2UiLCJ0ZXN0IiwicGFyc2VkQW5nbGUiLCJnZXRBbmdsZUluRGVncmVlcyIsInBhcnNlZERpcmVjdGlvbiIsImdldERpcmVjdGlvbkZvcktleXdvcmQiLCJmaXhlZENvbG9yU3RvcHMiLCJnZXRGaXhlZENvbG9yU3RvcHMiLCJjb25jYXQiLCJjc3NTdHJpbmciLCJncmFkaWVudHMiLCJtYXRjaCIsImxpbmVhckdyYWRpZW50UmVnZXgiLCJleGVjIiwiZ3JhZGllbnRDb250ZW50IiwicGFydHMiLCJzcGxpdCIsInRyaW1tZWREaXJlY3Rpb24iLCJ0cmltIiwiY29sb3JTdG9wUmVnZXgiLCJzaGlmdCIsImxhc3RJbmRleCIsImZ1bGxDb2xvclN0b3BzU3RyIiwiam9pbiIsImNvbG9yU3RvcE1hdGNoIiwiX2NvbG9yU3RvcE1hdGNoIiwiX2NvbG9yU3RvcE1hdGNoMiIsInBvc2l0aW9uMSIsInBvc2l0aW9uMiIsIm5vcm1hbGl6ZWQiLCJhbmdsZSIsIl9tYXRjaCIsInVuaXQiLCJudW1lcmljVmFsdWUiLCJNYXRoIiwiUEkiLCJfY29sb3JTdG9wcyQwJHBvc2l0aW8iLCJoYXNOdWxsUG9zaXRpb25zIiwibWF4UG9zaXRpb25Tb0ZhciIsImkiLCJuZXdQb3NpdGlvbiIsIm1heCIsImxhc3REZWZpbmVkSW5kZXgiLCJ1bmRlZmluZWQiLCJ1bnBvc2l0aW9uZWRTdG9wcyIsInN0YXJ0UG9zaXRpb24iLCJlbmRQb3NpdGlvbiIsImluY3JlbWVudCIsImoiXSwic291cmNlcyI6WyJwcm9jZXNzQmFja2dyb3VuZEltYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB0eXBlIHtQcm9jZXNzZWRDb2xvclZhbHVlfSBmcm9tICcuL3Byb2Nlc3NDb2xvcic7XG5pbXBvcnQgdHlwZSB7R3JhZGllbnRWYWx1ZX0gZnJvbSAnLi9TdHlsZVNoZWV0VHlwZXMnO1xuXG5jb25zdCBwcm9jZXNzQ29sb3IgPSByZXF1aXJlKCcuL3Byb2Nlc3NDb2xvcicpLmRlZmF1bHQ7XG5jb25zdCBESVJFQ1RJT05fS0VZV09SRF9SRUdFWCA9XG4gIC9edG9cXHMrKD86dG9wfGJvdHRvbXxsZWZ0fHJpZ2h0KSg/OlxccysoPzp0b3B8Ym90dG9tfGxlZnR8cmlnaHQpKT8vaTtcbmNvbnN0IEFOR0xFX1VOSVRfUkVHRVggPSAvXihbKy1dP1xcZCpcXC4/XFxkKykoZGVnfGdyYWR8cmFkfHR1cm4pJC9pO1xuXG50eXBlIExpbmVhckdyYWRpZW50RGlyZWN0aW9uID1cbiAgfCB7dHlwZTogJ2FuZ2xlJywgdmFsdWU6IG51bWJlcn1cbiAgfCB7dHlwZTogJ2tleXdvcmQnLCB2YWx1ZTogc3RyaW5nfTtcblxudHlwZSBQYXJzZWRHcmFkaWVudFZhbHVlID0ge1xuICB0eXBlOiAnbGluZWFyR3JhZGllbnQnLFxuICBkaXJlY3Rpb246IExpbmVhckdyYWRpZW50RGlyZWN0aW9uLFxuICBjb2xvclN0b3BzOiAkUmVhZE9ubHlBcnJheTx7XG4gICAgY29sb3I6IFByb2Nlc3NlZENvbG9yVmFsdWUsXG4gICAgcG9zaXRpb246IG51bWJlcixcbiAgfT4sXG59O1xuXG5jb25zdCBERUZBVUxUX0RJUkVDVElPTjogTGluZWFyR3JhZGllbnREaXJlY3Rpb24gPSB7XG4gIHR5cGU6ICdhbmdsZScsXG4gIHZhbHVlOiAxODAsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBwcm9jZXNzQmFja2dyb3VuZEltYWdlKFxuICBiYWNrZ3JvdW5kSW1hZ2U6ID8oJFJlYWRPbmx5QXJyYXk8R3JhZGllbnRWYWx1ZT4gfCBzdHJpbmcpLFxuKTogJFJlYWRPbmx5QXJyYXk8UGFyc2VkR3JhZGllbnRWYWx1ZT4ge1xuICBsZXQgcmVzdWx0OiAkUmVhZE9ubHlBcnJheTxQYXJzZWRHcmFkaWVudFZhbHVlPiA9IFtdO1xuICBpZiAoYmFja2dyb3VuZEltYWdlID09IG51bGwpIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgaWYgKHR5cGVvZiBiYWNrZ3JvdW5kSW1hZ2UgPT09ICdzdHJpbmcnKSB7XG4gICAgcmVzdWx0ID0gcGFyc2VDU1NMaW5lYXJHcmFkaWVudChiYWNrZ3JvdW5kSW1hZ2UucmVwbGFjZSgvXFxuL2csICcgJykpO1xuICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoYmFja2dyb3VuZEltYWdlKSkge1xuICAgIGZvciAoY29uc3QgYmdJbWFnZSBvZiBiYWNrZ3JvdW5kSW1hZ2UpIHtcbiAgICAgIGNvbnN0IHByb2Nlc3NlZENvbG9yU3RvcHM6IEFycmF5PHtcbiAgICAgICAgY29sb3I6IFByb2Nlc3NlZENvbG9yVmFsdWUsXG4gICAgICAgIHBvc2l0aW9uOiBudW1iZXIgfCBudWxsLFxuICAgICAgfT4gPSBbXTtcbiAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBiZ0ltYWdlLmNvbG9yU3RvcHMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgIGNvbnN0IGNvbG9yU3RvcCA9IGJnSW1hZ2UuY29sb3JTdG9wc1tpbmRleF07XG4gICAgICAgIGNvbnN0IHByb2Nlc3NlZENvbG9yID0gcHJvY2Vzc0NvbG9yKGNvbG9yU3RvcC5jb2xvcik7XG4gICAgICAgIGlmIChwcm9jZXNzZWRDb2xvciA9PSBudWxsKSB7XG4gICAgICAgICAgLy8gSWYgYSBjb2xvciBpcyBpbnZhbGlkLCByZXR1cm4gYW4gZW1wdHkgYXJyYXkgYW5kIGRvIG5vdCBhcHBseSBncmFkaWVudC4gU2FtZSBhcyB3ZWIuXG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb2xvclN0b3AucG9zaXRpb25zICE9IG51bGwgJiYgY29sb3JTdG9wLnBvc2l0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBwb3NpdGlvbiBvZiBjb2xvclN0b3AucG9zaXRpb25zKSB7XG4gICAgICAgICAgICBpZiAocG9zaXRpb24uZW5kc1dpdGgoJyUnKSkge1xuICAgICAgICAgICAgICBwcm9jZXNzZWRDb2xvclN0b3BzLnB1c2goe1xuICAgICAgICAgICAgICAgIGNvbG9yOiBwcm9jZXNzZWRDb2xvcixcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogcGFyc2VGbG9hdChwb3NpdGlvbikgLyAxMDAsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gSWYgYSBwb3NpdGlvbiBpcyBpbnZhbGlkLCByZXR1cm4gYW4gZW1wdHkgYXJyYXkgYW5kIGRvIG5vdCBhcHBseSBncmFkaWVudC4gU2FtZSBhcyB3ZWIuXG4gICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcHJvY2Vzc2VkQ29sb3JTdG9wcy5wdXNoKHtcbiAgICAgICAgICAgIGNvbG9yOiBwcm9jZXNzZWRDb2xvcixcbiAgICAgICAgICAgIHBvc2l0aW9uOiBudWxsLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxldCBkaXJlY3Rpb246IExpbmVhckdyYWRpZW50RGlyZWN0aW9uID0gREVGQVVMVF9ESVJFQ1RJT047XG4gICAgICBjb25zdCBiZ0RpcmVjdGlvbiA9XG4gICAgICAgIGJnSW1hZ2UuZGlyZWN0aW9uICE9IG51bGwgPyBiZ0ltYWdlLmRpcmVjdGlvbi50b0xvd2VyQ2FzZSgpIDogbnVsbDtcblxuICAgICAgaWYgKGJnRGlyZWN0aW9uICE9IG51bGwpIHtcbiAgICAgICAgaWYgKEFOR0xFX1VOSVRfUkVHRVgudGVzdChiZ0RpcmVjdGlvbikpIHtcbiAgICAgICAgICBjb25zdCBwYXJzZWRBbmdsZSA9IGdldEFuZ2xlSW5EZWdyZWVzKGJnRGlyZWN0aW9uKTtcbiAgICAgICAgICBpZiAocGFyc2VkQW5nbGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgZGlyZWN0aW9uID0ge1xuICAgICAgICAgICAgICB0eXBlOiAnYW5nbGUnLFxuICAgICAgICAgICAgICB2YWx1ZTogcGFyc2VkQW5nbGUsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBJZiBhbiBhbmdsZSBpcyBpbnZhbGlkLCByZXR1cm4gYW4gZW1wdHkgYXJyYXkgYW5kIGRvIG5vdCBhcHBseSBhbnkgZ3JhZGllbnQuIFNhbWUgYXMgd2ViLlxuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChESVJFQ1RJT05fS0VZV09SRF9SRUdFWC50ZXN0KGJnRGlyZWN0aW9uKSkge1xuICAgICAgICAgIGNvbnN0IHBhcnNlZERpcmVjdGlvbiA9IGdldERpcmVjdGlvbkZvcktleXdvcmQoYmdEaXJlY3Rpb24pO1xuICAgICAgICAgIGlmIChwYXJzZWREaXJlY3Rpb24gIT0gbnVsbCkge1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gcGFyc2VkRGlyZWN0aW9uO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBJZiBhIGRpcmVjdGlvbiBpcyBpbnZhbGlkLCByZXR1cm4gYW4gZW1wdHkgYXJyYXkgYW5kIGRvIG5vdCBhcHBseSBhbnkgZ3JhZGllbnQuIFNhbWUgYXMgd2ViLlxuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBJZiBhIGRpcmVjdGlvbiBpcyBpbnZhbGlkLCByZXR1cm4gYW4gZW1wdHkgYXJyYXkgYW5kIGRvIG5vdCBhcHBseSBhbnkgZ3JhZGllbnQuIFNhbWUgYXMgd2ViLlxuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBmaXhlZENvbG9yU3RvcHMgPSBnZXRGaXhlZENvbG9yU3RvcHMocHJvY2Vzc2VkQ29sb3JTdG9wcyk7XG5cbiAgICAgIHJlc3VsdCA9IHJlc3VsdC5jb25jYXQoe1xuICAgICAgICB0eXBlOiAnbGluZWFyR3JhZGllbnQnLFxuICAgICAgICBkaXJlY3Rpb24sXG4gICAgICAgIGNvbG9yU3RvcHM6IGZpeGVkQ29sb3JTdG9wcyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIHBhcnNlQ1NTTGluZWFyR3JhZGllbnQoXG4gIGNzc1N0cmluZzogc3RyaW5nLFxuKTogJFJlYWRPbmx5QXJyYXk8UGFyc2VkR3JhZGllbnRWYWx1ZT4ge1xuICBjb25zdCBncmFkaWVudHMgPSBbXTtcbiAgbGV0IG1hdGNoO1xuXG4gIC8vIG1hdGNoZXMgb25lIG9yIG1vcmUgbGluZWFyLWdyYWRpZW50IGZ1bmN0aW9ucyBpbiBDU1NcbiAgY29uc3QgbGluZWFyR3JhZGllbnRSZWdleCA9IC9saW5lYXItZ3JhZGllbnRcXHMqXFwoKCg/OlxcKFteKV0qXFwpfFteKCkpXSkqKVxcKS9naTtcblxuICB3aGlsZSAoKG1hdGNoID0gbGluZWFyR3JhZGllbnRSZWdleC5leGVjKGNzc1N0cmluZykpKSB7XG4gICAgY29uc3QgZ3JhZGllbnRDb250ZW50ID0gbWF0Y2hbMV07XG4gICAgY29uc3QgcGFydHMgPSBncmFkaWVudENvbnRlbnQuc3BsaXQoJywnKTtcbiAgICBsZXQgZGlyZWN0aW9uOiBMaW5lYXJHcmFkaWVudERpcmVjdGlvbiA9IERFRkFVTFRfRElSRUNUSU9OO1xuICAgIGNvbnN0IHRyaW1tZWREaXJlY3Rpb24gPSBwYXJ0c1swXS50cmltKCkudG9Mb3dlckNhc2UoKTtcblxuICAgIC8vIG1hdGNoZXMgaW5kaXZpZHVhbCBjb2xvciBzdG9wcyBpbiBhIGdyYWRpZW50IGZ1bmN0aW9uXG4gICAgLy8gc3VwcG9ydHMgdmFyaW91cyBjb2xvciBmb3JtYXRzOiBuYW1lZCBjb2xvcnMsIGhleCBjb2xvcnMsIHJnYihhKSwgYW5kIGhzbChhKVxuICAgIC8vIGUuZy4gXCJyZWQgMjAlXCIsIFwiYmx1ZSA1MCVcIiwgXCJyZ2JhKDAsIDAsIDAsIDAuNSkgMzAlIDUwJVwiXG4gICAgLy8gVE9ETzogZG9lcyBub3Qgc3VwcG9ydCBjb2xvciBoaW50IHN5bnRheCB5ZXQuIEl0IGlzIFdJUC5cbiAgICBjb25zdCBjb2xvclN0b3BSZWdleCA9XG4gICAgICAvXFxzKigoPzooPzpyZ2JhP3xoc2xhPylcXHMqXFwoW14pXStcXCkpfCNbMC05YS1mQS1GXSt8W2EtekEtWl0rKSg/OlxccysoLT9bMC05Ll0rJT8pKD86XFxzKygtP1swLTkuXSslPykpPyk/XFxzKi9naTtcblxuICAgIGlmIChBTkdMRV9VTklUX1JFR0VYLnRlc3QodHJpbW1lZERpcmVjdGlvbikpIHtcbiAgICAgIGNvbnN0IHBhcnNlZEFuZ2xlID0gZ2V0QW5nbGVJbkRlZ3JlZXModHJpbW1lZERpcmVjdGlvbik7XG4gICAgICBpZiAocGFyc2VkQW5nbGUgIT0gbnVsbCkge1xuICAgICAgICBkaXJlY3Rpb24gPSB7XG4gICAgICAgICAgdHlwZTogJ2FuZ2xlJyxcbiAgICAgICAgICB2YWx1ZTogcGFyc2VkQW5nbGUsXG4gICAgICAgIH07XG4gICAgICAgIHBhcnRzLnNoaWZ0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBhbiBhbmdsZSBpcyBpbnZhbGlkLCByZXR1cm4gYW4gZW1wdHkgYXJyYXkgYW5kIGRvIG5vdCBhcHBseSBhbnkgZ3JhZGllbnQuIFNhbWUgYXMgd2ViLlxuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChESVJFQ1RJT05fS0VZV09SRF9SRUdFWC50ZXN0KHRyaW1tZWREaXJlY3Rpb24pKSB7XG4gICAgICBjb25zdCBwYXJzZWREaXJlY3Rpb24gPSBnZXREaXJlY3Rpb25Gb3JLZXl3b3JkKHRyaW1tZWREaXJlY3Rpb24pO1xuICAgICAgaWYgKHBhcnNlZERpcmVjdGlvbiAhPSBudWxsKSB7XG4gICAgICAgIGRpcmVjdGlvbiA9IHBhcnNlZERpcmVjdGlvbjtcbiAgICAgICAgcGFydHMuc2hpZnQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIGEgZGlyZWN0aW9uIGlzIGludmFsaWQsIHJldHVybiBhbiBlbXB0eSBhcnJheSBhbmQgZG8gbm90IGFwcGx5IGFueSBncmFkaWVudC4gU2FtZSBhcyB3ZWIuXG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFjb2xvclN0b3BSZWdleC50ZXN0KHRyaW1tZWREaXJlY3Rpb24pKSB7XG4gICAgICAvLyBJZiBmaXJzdCBwYXJ0IGlzIG5vdCBhbiBhbmdsZS9kaXJlY3Rpb24gb3IgYSBjb2xvciBzdG9wLCByZXR1cm4gYW4gZW1wdHkgYXJyYXkgYW5kIGRvIG5vdCBhcHBseSBhbnkgZ3JhZGllbnQuIFNhbWUgYXMgd2ViLlxuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb2xvclN0b3BSZWdleC5sYXN0SW5kZXggPSAwO1xuXG4gICAgY29uc3QgY29sb3JTdG9wcyA9IFtdO1xuICAgIGNvbnN0IGZ1bGxDb2xvclN0b3BzU3RyID0gcGFydHMuam9pbignLCcpO1xuICAgIGxldCBjb2xvclN0b3BNYXRjaDtcbiAgICB3aGlsZSAoKGNvbG9yU3RvcE1hdGNoID0gY29sb3JTdG9wUmVnZXguZXhlYyhmdWxsQ29sb3JTdG9wc1N0cikpKSB7XG4gICAgICBjb25zdCBbLCBjb2xvciwgcG9zaXRpb24xLCBwb3NpdGlvbjJdID0gY29sb3JTdG9wTWF0Y2g7XG4gICAgICBjb25zdCBwcm9jZXNzZWRDb2xvciA9IHByb2Nlc3NDb2xvcihjb2xvci50cmltKCkudG9Mb3dlckNhc2UoKSk7XG4gICAgICBpZiAocHJvY2Vzc2VkQ29sb3IgPT0gbnVsbCkge1xuICAgICAgICAvLyBJZiBhIGNvbG9yIGlzIGludmFsaWQsIHJldHVybiBhbiBlbXB0eSBhcnJheSBhbmQgZG8gbm90IGFwcGx5IGFueSBncmFkaWVudC4gU2FtZSBhcyB3ZWIuXG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBwb3NpdGlvbjEgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIGlmIChwb3NpdGlvbjEuZW5kc1dpdGgoJyUnKSkge1xuICAgICAgICAgIGNvbG9yU3RvcHMucHVzaCh7XG4gICAgICAgICAgICBjb2xvcjogcHJvY2Vzc2VkQ29sb3IsXG4gICAgICAgICAgICBwb3NpdGlvbjogcGFyc2VGbG9hdChwb3NpdGlvbjEpIC8gMTAwLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIElmIGEgcG9zaXRpb24gaXMgaW52YWxpZCwgcmV0dXJuIGFuIGVtcHR5IGFycmF5IGFuZCBkbyBub3QgYXBwbHkgYW55IGdyYWRpZW50LiBTYW1lIGFzIHdlYi5cbiAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbG9yU3RvcHMucHVzaCh7XG4gICAgICAgICAgY29sb3I6IHByb2Nlc3NlZENvbG9yLFxuICAgICAgICAgIHBvc2l0aW9uOiBudWxsLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBwb3NpdGlvbjIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIGlmIChwb3NpdGlvbjIuZW5kc1dpdGgoJyUnKSkge1xuICAgICAgICAgIGNvbG9yU3RvcHMucHVzaCh7XG4gICAgICAgICAgICBjb2xvcjogcHJvY2Vzc2VkQ29sb3IsXG4gICAgICAgICAgICBwb3NpdGlvbjogcGFyc2VGbG9hdChwb3NpdGlvbjIpIC8gMTAwLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIElmIGEgcG9zaXRpb24gaXMgaW52YWxpZCwgcmV0dXJuIGFuIGVtcHR5IGFycmF5IGFuZCBkbyBub3QgYXBwbHkgYW55IGdyYWRpZW50LiBTYW1lIGFzIHdlYi5cbiAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBmaXhlZENvbG9yU3RvcHMgPSBnZXRGaXhlZENvbG9yU3RvcHMoY29sb3JTdG9wcyk7XG5cbiAgICBncmFkaWVudHMucHVzaCh7XG4gICAgICB0eXBlOiAnbGluZWFyR3JhZGllbnQnLFxuICAgICAgZGlyZWN0aW9uLFxuICAgICAgY29sb3JTdG9wczogZml4ZWRDb2xvclN0b3BzLFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIGdyYWRpZW50cztcbn1cblxuZnVuY3Rpb24gZ2V0RGlyZWN0aW9uRm9yS2V5d29yZChkaXJlY3Rpb24/OiBzdHJpbmcpOiA/TGluZWFyR3JhZGllbnREaXJlY3Rpb24ge1xuICBpZiAoZGlyZWN0aW9uID09IG51bGwpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICAvLyBSZW1vdmUgZXh0cmEgd2hpdGVzcGFjZVxuICBjb25zdCBub3JtYWxpemVkID0gZGlyZWN0aW9uLnJlcGxhY2UoL1xccysvZywgJyAnKS50b0xvd2VyQ2FzZSgpO1xuXG4gIHN3aXRjaCAobm9ybWFsaXplZCkge1xuICAgIGNhc2UgJ3RvIHRvcCc6XG4gICAgICByZXR1cm4ge3R5cGU6ICdhbmdsZScsIHZhbHVlOiAwfTtcbiAgICBjYXNlICd0byByaWdodCc6XG4gICAgICByZXR1cm4ge3R5cGU6ICdhbmdsZScsIHZhbHVlOiA5MH07XG4gICAgY2FzZSAndG8gYm90dG9tJzpcbiAgICAgIHJldHVybiB7dHlwZTogJ2FuZ2xlJywgdmFsdWU6IDE4MH07XG4gICAgY2FzZSAndG8gbGVmdCc6XG4gICAgICByZXR1cm4ge3R5cGU6ICdhbmdsZScsIHZhbHVlOiAyNzB9O1xuICAgIGNhc2UgJ3RvIHRvcCByaWdodCc6XG4gICAgY2FzZSAndG8gcmlnaHQgdG9wJzpcbiAgICAgIHJldHVybiB7dHlwZTogJ2tleXdvcmQnLCB2YWx1ZTogJ3RvIHRvcCByaWdodCd9O1xuICAgIGNhc2UgJ3RvIGJvdHRvbSByaWdodCc6XG4gICAgY2FzZSAndG8gcmlnaHQgYm90dG9tJzpcbiAgICAgIHJldHVybiB7dHlwZTogJ2tleXdvcmQnLCB2YWx1ZTogJ3RvIGJvdHRvbSByaWdodCd9O1xuICAgIGNhc2UgJ3RvIHRvcCBsZWZ0JzpcbiAgICBjYXNlICd0byBsZWZ0IHRvcCc6XG4gICAgICByZXR1cm4ge3R5cGU6ICdrZXl3b3JkJywgdmFsdWU6ICd0byB0b3AgbGVmdCd9O1xuICAgIGNhc2UgJ3RvIGJvdHRvbSBsZWZ0JzpcbiAgICBjYXNlICd0byBsZWZ0IGJvdHRvbSc6XG4gICAgICByZXR1cm4ge3R5cGU6ICdrZXl3b3JkJywgdmFsdWU6ICd0byBib3R0b20gbGVmdCd9O1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRBbmdsZUluRGVncmVlcyhhbmdsZT86IHN0cmluZyk6ID9udW1iZXIge1xuICBpZiAoYW5nbGUgPT0gbnVsbCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGNvbnN0IG1hdGNoID0gYW5nbGUubWF0Y2goQU5HTEVfVU5JVF9SRUdFWCk7XG4gIGlmICghbWF0Y2gpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IFssIHZhbHVlLCB1bml0XSA9IG1hdGNoO1xuXG4gIGNvbnN0IG51bWVyaWNWYWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpO1xuICBzd2l0Y2ggKHVuaXQpIHtcbiAgICBjYXNlICdkZWcnOlxuICAgICAgcmV0dXJuIG51bWVyaWNWYWx1ZTtcbiAgICBjYXNlICdncmFkJzpcbiAgICAgIHJldHVybiBudW1lcmljVmFsdWUgKiAwLjk7IC8vIDEgZ3JhZCA9IDAuOSBkZWdyZWVzXG4gICAgY2FzZSAncmFkJzpcbiAgICAgIHJldHVybiAobnVtZXJpY1ZhbHVlICogMTgwKSAvIE1hdGguUEk7XG4gICAgY2FzZSAndHVybic6XG4gICAgICByZXR1cm4gbnVtZXJpY1ZhbHVlICogMzYwOyAvLyAxIHR1cm4gPSAzNjAgZGVncmVlc1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLWltYWdlcy00LyNjb2xvci1zdG9wLWZpeHVwXG5mdW5jdGlvbiBnZXRGaXhlZENvbG9yU3RvcHMoXG4gIGNvbG9yU3RvcHM6ICRSZWFkT25seUFycmF5PHtcbiAgICBjb2xvcjogUHJvY2Vzc2VkQ29sb3JWYWx1ZSxcbiAgICBwb3NpdGlvbjogbnVtYmVyIHwgbnVsbCxcbiAgfT4sXG4pOiBBcnJheTx7XG4gIGNvbG9yOiBQcm9jZXNzZWRDb2xvclZhbHVlLFxuICBwb3NpdGlvbjogbnVtYmVyLFxufT4ge1xuICBsZXQgZml4ZWRDb2xvclN0b3BzOiBBcnJheTx7XG4gICAgY29sb3I6IFByb2Nlc3NlZENvbG9yVmFsdWUsXG4gICAgcG9zaXRpb246IG51bWJlcixcbiAgfT4gPSBbXTtcbiAgbGV0IGhhc051bGxQb3NpdGlvbnMgPSBmYWxzZTtcbiAgbGV0IG1heFBvc2l0aW9uU29GYXIgPSBjb2xvclN0b3BzWzBdLnBvc2l0aW9uID8/IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY29sb3JTdG9wcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGNvbG9yU3RvcCA9IGNvbG9yU3RvcHNbaV07XG4gICAgbGV0IG5ld1Bvc2l0aW9uID0gY29sb3JTdG9wLnBvc2l0aW9uO1xuICAgIGlmIChuZXdQb3NpdGlvbiA9PT0gbnVsbCkge1xuICAgICAgLy8gU3RlcCAxOlxuICAgICAgLy8gSWYgdGhlIGZpcnN0IGNvbG9yIHN0b3AgZG9lcyBub3QgaGF2ZSBhIHBvc2l0aW9uLFxuICAgICAgLy8gc2V0IGl0cyBwb3NpdGlvbiB0byAwJS4gSWYgdGhlIGxhc3QgY29sb3Igc3RvcCBkb2VzIG5vdCBoYXZlIGEgcG9zaXRpb24sXG4gICAgICAvLyBzZXQgaXRzIHBvc2l0aW9uIHRvIDEwMCUuXG4gICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICBuZXdQb3NpdGlvbiA9IDA7XG4gICAgICB9IGVsc2UgaWYgKGkgPT09IGNvbG9yU3RvcHMubGVuZ3RoIC0gMSkge1xuICAgICAgICBuZXdQb3NpdGlvbiA9IDE7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIFN0ZXAgMjpcbiAgICAvLyBJZiBhIGNvbG9yIHN0b3Agb3IgdHJhbnNpdGlvbiBoaW50IGhhcyBhIHBvc2l0aW9uXG4gICAgLy8gdGhhdCBpcyBsZXNzIHRoYW4gdGhlIHNwZWNpZmllZCBwb3NpdGlvbiBvZiBhbnkgY29sb3Igc3RvcCBvciB0cmFuc2l0aW9uIGhpbnRcbiAgICAvLyBiZWZvcmUgaXQgaW4gdGhlIGxpc3QsIHNldCBpdHMgcG9zaXRpb24gdG8gYmUgZXF1YWwgdG8gdGhlXG4gICAgLy8gbGFyZ2VzdCBzcGVjaWZpZWQgcG9zaXRpb24gb2YgYW55IGNvbG9yIHN0b3Agb3IgdHJhbnNpdGlvbiBoaW50IGJlZm9yZSBpdC5cbiAgICBpZiAobmV3UG9zaXRpb24gIT09IG51bGwpIHtcbiAgICAgIG5ld1Bvc2l0aW9uID0gTWF0aC5tYXgobmV3UG9zaXRpb24sIG1heFBvc2l0aW9uU29GYXIpO1xuICAgICAgZml4ZWRDb2xvclN0b3BzW2ldID0ge1xuICAgICAgICBjb2xvcjogY29sb3JTdG9wLmNvbG9yLFxuICAgICAgICBwb3NpdGlvbjogbmV3UG9zaXRpb24sXG4gICAgICB9O1xuICAgICAgbWF4UG9zaXRpb25Tb0ZhciA9IG5ld1Bvc2l0aW9uO1xuICAgIH0gZWxzZSB7XG4gICAgICBoYXNOdWxsUG9zaXRpb25zID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvLyBTdGVwIDM6XG4gIC8vIElmIGFueSBjb2xvciBzdG9wIHN0aWxsIGRvZXMgbm90IGhhdmUgYSBwb3NpdGlvbixcbiAgLy8gdGhlbiwgZm9yIGVhY2ggcnVuIG9mIGFkamFjZW50IGNvbG9yIHN0b3BzIHdpdGhvdXQgcG9zaXRpb25zLFxuICAvLyBzZXQgdGhlaXIgcG9zaXRpb25zIHNvIHRoYXQgdGhleSBhcmUgZXZlbmx5IHNwYWNlZCBiZXR3ZWVuIHRoZSBwcmVjZWRpbmcgYW5kXG4gIC8vIGZvbGxvd2luZyBjb2xvciBzdG9wcyB3aXRoIHBvc2l0aW9ucy5cbiAgaWYgKGhhc051bGxQb3NpdGlvbnMpIHtcbiAgICBsZXQgbGFzdERlZmluZWRJbmRleCA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBmaXhlZENvbG9yU3RvcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChmaXhlZENvbG9yU3RvcHNbaV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zdCB1bnBvc2l0aW9uZWRTdG9wcyA9IGkgLSBsYXN0RGVmaW5lZEluZGV4IC0gMTtcbiAgICAgICAgaWYgKHVucG9zaXRpb25lZFN0b3BzID4gMCkge1xuICAgICAgICAgIGNvbnN0IHN0YXJ0UG9zaXRpb24gPSBmaXhlZENvbG9yU3RvcHNbbGFzdERlZmluZWRJbmRleF0ucG9zaXRpb247XG4gICAgICAgICAgY29uc3QgZW5kUG9zaXRpb24gPSBmaXhlZENvbG9yU3RvcHNbaV0ucG9zaXRpb247XG4gICAgICAgICAgY29uc3QgaW5jcmVtZW50ID1cbiAgICAgICAgICAgIChlbmRQb3NpdGlvbiAtIHN0YXJ0UG9zaXRpb24pIC8gKHVucG9zaXRpb25lZFN0b3BzICsgMSk7XG4gICAgICAgICAgZm9yIChsZXQgaiA9IDE7IGogPD0gdW5wb3NpdGlvbmVkU3RvcHM7IGorKykge1xuICAgICAgICAgICAgZml4ZWRDb2xvclN0b3BzW2xhc3REZWZpbmVkSW5kZXggKyBqXSA9IHtcbiAgICAgICAgICAgICAgY29sb3I6IGNvbG9yU3RvcHNbbGFzdERlZmluZWRJbmRleCArIGpdLmNvbG9yLFxuICAgICAgICAgICAgICBwb3NpdGlvbjogc3RhcnRQb3NpdGlvbiArIGluY3JlbWVudCAqIGosXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsYXN0RGVmaW5lZEluZGV4ID0gaTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gZml4ZWRDb2xvclN0b3BzO1xufVxuIl0sIm1hcHBpbmdzIjoiQUFVQSxZQUFZOztBQUFDLElBQUFBLHNCQUFBLEdBQUFDLE9BQUE7QUFBQUMsTUFBQSxDQUFBQyxjQUFBLENBQUFDLE9BQUE7RUFBQUMsS0FBQTtBQUFBO0FBQUFELE9BQUEsQ0FBQUUsT0FBQSxHQUFBQyxzQkFBQTtBQUFBLElBQUFDLGVBQUEsR0FBQVIsc0JBQUEsQ0FBQUMsT0FBQTtBQUtiLElBQU1RLFlBQVksR0FBR1IsT0FBTyxpQkFBaUIsQ0FBQyxDQUFDSyxPQUFPO0FBQ3RELElBQU1JLHVCQUF1QixHQUMzQixtRUFBbUU7QUFDckUsSUFBTUMsZ0JBQWdCLEdBQUcsd0NB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