c08f59e041cbf5c31a23c74065956fcb
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var PixelRatio = require("../Utilities/PixelRatio").default;
var Platform = require("../Utilities/Platform");
var _require = require("./AssetUtils"),
  pickScale = _require.pickScale;
var _require2 = require('@react-native/assets-registry/path-support'),
  getAndroidResourceFolderName = _require2.getAndroidResourceFolderName,
  getAndroidResourceIdentifier = _require2.getAndroidResourceIdentifier,
  getBasePath = _require2.getBasePath;
var invariant = require('invariant');
function getScaledAssetPath(asset) {
  var scale = pickScale(asset.scales, PixelRatio.get());
  var scaleSuffix = scale === 1 ? '' : '@' + scale + 'x';
  var assetDir = getBasePath(asset);
  return assetDir + '/' + asset.name + scaleSuffix + '.' + asset.type;
}
function getAssetPathInDrawableFolder(asset) {
  var scale = pickScale(asset.scales, PixelRatio.get());
  var drawableFolder = getAndroidResourceFolderName(asset, scale);
  var fileName = getAndroidResourceIdentifier(asset);
  return drawableFolder + '/' + fileName + '.' + asset.type;
}
function assetSupportsNetworkLoads(asset) {
  return !(asset.type === 'xml' && Platform.OS === 'android');
}
var AssetSourceResolver = function () {
  function AssetSourceResolver(serverUrl, jsbundleUrl, asset) {
    (0, _classCallCheck2.default)(this, AssetSourceResolver);
    this.serverUrl = serverUrl;
    this.jsbundleUrl = jsbundleUrl;
    this.asset = asset;
  }
  return (0, _createClass2.default)(AssetSourceResolver, [{
    key: "isLoadedFromServer",
    value: function isLoadedFromServer() {
      return this.serverUrl != null && this.serverUrl !== '' && assetSupportsNetworkLoads(this.asset);
    }
  }, {
    key: "isLoadedFromFileSystem",
    value: function isLoadedFromFileSystem() {
      var _this$jsbundleUrl;
      return this.jsbundleUrl != null && ((_this$jsbundleUrl = this.jsbundleUrl) == null ? void 0 : _this$jsbundleUrl.startsWith('file://'));
    }
  }, {
    key: "defaultAsset",
    value: function defaultAsset() {
      if (this.isLoadedFromServer()) {
        return this.assetServerURL();
      }
      if (this.asset.resolver != null) {
        return this.getAssetUsingResolver(this.asset.resolver);
      }
      if (Platform.OS === 'android') {
        return this.isLoadedFromFileSystem() ? this.drawableFolderInBundle() : this.resourceIdentifierWithoutScale();
      } else {
        return this.scaledAssetURLNearBundle();
      }
    }
  }, {
    key: "getAssetUsingResolver",
    value: function getAssetUsingResolver(resolver) {
      switch (resolver) {
        case 'android':
          return this.isLoadedFromFileSystem() ? this.drawableFolderInBundle() : this.resourceIdentifierWithoutScale();
        case 'generic':
          return this.scaledAssetURLNearBundle();
        default:
          throw new Error("Don't know how to get asset via provided resolver: " + resolver + '\nAsset: ' + JSON.stringify(this.asset, null, '\t') + '\nPossible resolvers are:' + JSON.stringify(['android', 'generic'], null, '\t'));
      }
    }
  }, {
    key: "assetServerURL",
    value: function assetServerURL() {
      invariant(this.serverUrl != null, 'need server to load from');
      return this.fromSource(this.serverUrl + getScaledAssetPath(this.asset) + '?platform=' + Platform.OS + '&hash=' + this.asset.hash);
    }
  }, {
    key: "scaledAssetPath",
    value: function scaledAssetPath() {
      return this.fromSource(getScaledAssetPath(this.asset));
    }
  }, {
    key: "scaledAssetURLNearBundle",
    value: function scaledAssetURLNearBundle() {
      var _this$jsbundleUrl2;
      var path = (_this$jsbundleUrl2 = this.jsbundleUrl) != null ? _this$jsbundleUrl2 : 'file://';
      return this.fromSource(path + getScaledAssetPath(this.asset).replace(/\.\.\//g, '_'));
    }
  }, {
    key: "resourceIdentifierWithoutScale",
    value: function resourceIdentifierWithoutScale() {
      invariant(Platform.OS === 'android', 'resource identifiers work on Android');
      return this.fromSource(getAndroidResourceIdentifier(this.asset));
    }
  }, {
    key: "drawableFolderInBundle",
    value: function drawableFolderInBundle() {
      var _this$jsbundleUrl3;
      var path = (_this$jsbundleUrl3 = this.jsbundleUrl) != null ? _this$jsbundleUrl3 : 'file://';
      return this.fromSource(path + getAssetPathInDrawableFolder(this.asset));
    }
  }, {
    key: "fromSource",
    value: function fromSource(source) {
      return {
        __packager_asset: true,
        width: this.asset.width,
        height: this.asset.height,
        uri: source,
        scale: pickScale(this.asset.scales, PixelRatio.get())
      };
    }
  }]);
}();
AssetSourceResolver.pickScale = pickScale;
module.exports = AssetSourceResolver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiUGl4ZWxSYXRpbyIsImRlZmF1bHQiLCJQbGF0Zm9ybSIsIl9yZXF1aXJlIiwicGlja1NjYWxlIiwiX3JlcXVpcmUyIiwiZ2V0QW5kcm9pZFJlc291cmNlRm9sZGVyTmFtZSIsImdldEFuZHJvaWRSZXNvdXJjZUlkZW50aWZpZXIiLCJnZXRCYXNlUGF0aCIsImludmFyaWFudCIsImdldFNjYWxlZEFzc2V0UGF0aCIsImFzc2V0Iiwic2NhbGUiLCJzY2FsZXMiLCJnZXQiLCJzY2FsZVN1ZmZpeCIsImFzc2V0RGlyIiwibmFtZSIsInR5cGUiLCJnZXRBc3NldFBhdGhJbkRyYXdhYmxlRm9sZGVyIiwiZHJhd2FibGVGb2xkZXIiLCJmaWxlTmFtZSIsImFzc2V0U3VwcG9ydHNOZXR3b3JrTG9hZHMiLCJPUyIsIkFzc2V0U291cmNlUmVzb2x2ZXIiLCJzZXJ2ZXJVcmwiLCJqc2J1bmRsZVVybCIsImtleSIsInZhbHVlIiwiaXNMb2FkZWRGcm9tU2VydmVyIiwiaXNMb2FkZWRGcm9tRmlsZVN5c3RlbSIsIl90aGlzJGpzYnVuZGxlVXJsIiwic3RhcnRzV2l0aCIsImRlZmF1bHRBc3NldCIsImFzc2V0U2VydmVyVVJMIiwicmVzb2x2ZXIiLCJnZXRBc3NldFVzaW5nUmVzb2x2ZXIiLCJkcmF3YWJsZUZvbGRlckluQnVuZGxlIiwicmVzb3VyY2VJZGVudGlmaWVyV2l0aG91dFNjYWxlIiwic2NhbGVkQXNzZXRVUkxOZWFyQnVuZGxlIiwiRXJyb3IiLCJKU09OIiwic3RyaW5naWZ5IiwiZnJvbVNvdXJjZSIsImhhc2giLCJzY2FsZWRBc3NldFBhdGgiLCJfdGhpcyRqc2J1bmRsZVVybDIiLCJwYXRoIiwicmVwbGFjZSIsIl90aGlzJGpzYnVuZGxlVXJsMyIsInNvdXJjZSIsIl9fcGFja2FnZXJfYXNzZXQiLCJ3aWR0aCIsImhlaWdodCIsInVyaSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJBc3NldFNvdXJjZVJlc29sdmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydCB0eXBlIFJlc29sdmVkQXNzZXRTb3VyY2UgPSB7fFxuICArX19wYWNrYWdlcl9hc3NldDogYm9vbGVhbixcbiAgK3dpZHRoOiA/bnVtYmVyLFxuICAraGVpZ2h0OiA/bnVtYmVyLFxuICArdXJpOiBzdHJpbmcsXG4gICtzY2FsZTogbnVtYmVyLFxufH07XG5cbmltcG9ydCB0eXBlIHtcbiAgQXNzZXREZXN0UGF0aFJlc29sdmVyLFxuICBQYWNrYWdlckFzc2V0LFxufSBmcm9tICdAcmVhY3QtbmF0aXZlL2Fzc2V0cy1yZWdpc3RyeS9yZWdpc3RyeSc7XG5cbmNvbnN0IFBpeGVsUmF0aW8gPSByZXF1aXJlKCcuLi9VdGlsaXRpZXMvUGl4ZWxSYXRpbycpLmRlZmF1bHQ7XG5jb25zdCBQbGF0Zm9ybSA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy9QbGF0Zm9ybScpO1xuY29uc3Qge3BpY2tTY2FsZX0gPSByZXF1aXJlKCcuL0Fzc2V0VXRpbHMnKTtcbmNvbnN0IHtcbiAgZ2V0QW5kcm9pZFJlc291cmNlRm9sZGVyTmFtZSxcbiAgZ2V0QW5kcm9pZFJlc291cmNlSWRlbnRpZmllcixcbiAgZ2V0QmFzZVBhdGgsXG59ID0gcmVxdWlyZSgnQHJlYWN0LW5hdGl2ZS9hc3NldHMtcmVnaXN0cnkvcGF0aC1zdXBwb3J0Jyk7XG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdpbnZhcmlhbnQnKTtcblxuLyoqXG4gKiBSZXR1cm5zIGEgcGF0aCBsaWtlICdhc3NldHMvQXdlc29tZU1vZHVsZS9pY29uQDJ4LnBuZydcbiAqL1xuZnVuY3Rpb24gZ2V0U2NhbGVkQXNzZXRQYXRoKGFzc2V0OiBQYWNrYWdlckFzc2V0KTogc3RyaW5nIHtcbiAgY29uc3Qgc2NhbGUgPSBwaWNrU2NhbGUoYXNzZXQuc2NhbGVzLCBQaXhlbFJhdGlvLmdldCgpKTtcbiAgY29uc3Qgc2NhbGVTdWZmaXggPSBzY2FsZSA9PT0gMSA/ICcnIDogJ0AnICsgc2NhbGUgKyAneCc7XG4gIGNvbnN0IGFzc2V0RGlyID0gZ2V0QmFzZVBhdGgoYXNzZXQpO1xuICByZXR1cm4gYXNzZXREaXIgKyAnLycgKyBhc3NldC5uYW1lICsgc2NhbGVTdWZmaXggKyAnLicgKyBhc3NldC50eXBlO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBwYXRoIGxpa2UgJ2RyYXdhYmxlLW1kcGkvaWNvbi5wbmcnXG4gKi9cbmZ1bmN0aW9uIGdldEFzc2V0UGF0aEluRHJhd2FibGVGb2xkZXIoYXNzZXQ6IFBhY2thZ2VyQXNzZXQpOiBzdHJpbmcge1xuICBjb25zdCBzY2FsZSA9IHBpY2tTY2FsZShhc3NldC5zY2FsZXMsIFBpeGVsUmF0aW8uZ2V0KCkpO1xuICBjb25zdCBkcmF3YWJsZUZvbGRlciA9IGdldEFuZHJvaWRSZXNvdXJjZUZvbGRlck5hbWUoYXNzZXQsIHNjYWxlKTtcbiAgY29uc3QgZmlsZU5hbWUgPSBnZXRBbmRyb2lkUmVzb3VyY2VJZGVudGlmaWVyKGFzc2V0KTtcbiAgcmV0dXJuIGRyYXdhYmxlRm9sZGVyICsgJy8nICsgZmlsZU5hbWUgKyAnLicgKyBhc3NldC50eXBlO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgYXNzZXQgY2FuIGJlIGxvYWRlZCBvdmVyIHRoZSBuZXR3b3JrLlxuICpcbiAqIFRoaXMgcHJldmVudHMgYW4gaXNzdWUgbG9hZGluZyBYTUwgYXNzZXRzIG9uIEFuZHJvaWQuIFhNTCBhc3NldCB0eXBlcyBsaWtlXG4gKiB2ZWN0b3IgZHJhd2FibGVzIGNhbiBvbmx5IGJlIGxvYWRlZCBmcm9tIHByZWNvbXBpbGVkIHNvdXJjZS4gQW5kcm9pZCBkb2VzXG4gKiBub3Qgc3VwcG9ydCBsb2FkaW5nIHRoZXNlIG92ZXIgdGhlIG5ldHdvcmssIGFuZCBBQVBUIHByZWNvbXBpbGVzIGRhdGEgYnlcbiAqIGJyZWFraW5nIHBhdGggZGF0YSBhbmQgcmVzb3VyY2UgaW5mb3JtYXRpb24gYXBhcnQgaW50byBtdWx0aXBsZSBmaWxlcyxcbiAqIHN0dWZmaW5nIGl0IGFsbCBpbnRvIHRoZSByZXNvdXJjZSB0YWJsZS4gQXMgYSByZXN1bHQsIHdlIHNob3VsZCBvbmx5IGF0dGVtcHRcbiAqIHRvIGxvYWQgcmVzb3VyY2VzIGFzIHdlIHdvdWxkIGluIHJlbGVhc2UgYnVpbGRzOiBieSB0aGUgcmVzb3VyY2UgbmFtZS5cbiAqXG4gKiBGb3IgbW9yZSBpbmZvcm1hdGlvbiwgc2VlOlxuICogaHR0cHM6Ly9pc3N1ZXRyYWNrZXIuZ29vZ2xlLmNvbS9pc3N1ZXMvNjI0MzUwNjlcbiAqIGh0dHBzOi8vaXNzdWV0cmFja2VyLmdvb2dsZS5jb20vaXNzdWVzLzY4MjkzMTg5XG4gKi9cbmZ1bmN0aW9uIGFzc2V0U3VwcG9ydHNOZXR3b3JrTG9hZHMoYXNzZXQ6IFBhY2thZ2VyQXNzZXQpOiBib29sZWFuIHtcbiAgcmV0dXJuICEoYXNzZXQudHlwZSA9PT0gJ3htbCcgJiYgUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJyk7XG59XG5cbmNsYXNzIEFzc2V0U291cmNlUmVzb2x2ZXIge1xuICBzZXJ2ZXJVcmw6ID9zdHJpbmc7XG4gIC8vIHdoZXJlIHRoZSBqc2J1bmRsZSBpcyBiZWluZyBydW4gZnJvbVxuICBqc2J1bmRsZVVybDogP3N0cmluZztcbiAgLy8gdGhlIGFzc2V0IHRvIHJlc29sdmVcbiAgYXNzZXQ6IFBhY2thZ2VyQXNzZXQ7XG5cbiAgY29uc3RydWN0b3Ioc2VydmVyVXJsOiA/c3RyaW5nLCBqc2J1bmRsZVVybDogP3N0cmluZywgYXNzZXQ6IFBhY2thZ2VyQXNzZXQpIHtcbiAgICB0aGlzLnNlcnZlclVybCA9IHNlcnZlclVybDtcbiAgICB0aGlzLmpzYnVuZGxlVXJsID0ganNidW5kbGVVcmw7XG4gICAgdGhpcy5hc3NldCA9IGFzc2V0O1xuICB9XG5cbiAgaXNMb2FkZWRGcm9tU2VydmVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLnNlcnZlclVybCAhPSBudWxsICYmXG4gICAgICB0aGlzLnNlcnZlclVybCAhPT0gJycgJiZcbiAgICAgIGFzc2V0U3VwcG9ydHNOZXR3b3JrTG9hZHModGhpcy5hc3NldClcbiAgICApO1xuICB9XG5cbiAgaXNMb2FkZWRGcm9tRmlsZVN5c3RlbSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5qc2J1bmRsZVVybCAhPSBudWxsICYmIHRoaXMuanNidW5kbGVVcmw/LnN0YXJ0c1dpdGgoJ2ZpbGU6Ly8nKTtcbiAgfVxuXG4gIGRlZmF1bHRBc3NldCgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBpZiAodGhpcy5pc0xvYWRlZEZyb21TZXJ2ZXIoKSkge1xuICAgICAgcmV0dXJuIHRoaXMuYXNzZXRTZXJ2ZXJVUkwoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hc3NldC5yZXNvbHZlciAhPSBudWxsKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRBc3NldFVzaW5nUmVzb2x2ZXIodGhpcy5hc3NldC5yZXNvbHZlcik7XG4gICAgfVxuXG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICAgIHJldHVybiB0aGlzLmlzTG9hZGVkRnJvbUZpbGVTeXN0ZW0oKVxuICAgICAgICA/IHRoaXMuZHJhd2FibGVGb2xkZXJJbkJ1bmRsZSgpXG4gICAgICAgIDogdGhpcy5yZXNvdXJjZUlkZW50aWZpZXJXaXRob3V0U2NhbGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuc2NhbGVkQXNzZXRVUkxOZWFyQnVuZGxlKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0QXNzZXRVc2luZ1Jlc29sdmVyKHJlc29sdmVyOiBBc3NldERlc3RQYXRoUmVzb2x2ZXIpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBzd2l0Y2ggKHJlc29sdmVyKSB7XG4gICAgICBjYXNlICdhbmRyb2lkJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNMb2FkZWRGcm9tRmlsZVN5c3RlbSgpXG4gICAgICAgICAgPyB0aGlzLmRyYXdhYmxlRm9sZGVySW5CdW5kbGUoKVxuICAgICAgICAgIDogdGhpcy5yZXNvdXJjZUlkZW50aWZpZXJXaXRob3V0U2NhbGUoKTtcbiAgICAgIGNhc2UgJ2dlbmVyaWMnOlxuICAgICAgICByZXR1cm4gdGhpcy5zY2FsZWRBc3NldFVSTE5lYXJCdW5kbGUoKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkRvbid0IGtub3cgaG93IHRvIGdldCBhc3NldCB2aWEgcHJvdmlkZWQgcmVzb2x2ZXI6IFwiICtcbiAgICAgICAgICAgIHJlc29sdmVyICtcbiAgICAgICAgICAgICdcXG5Bc3NldDogJyArXG4gICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLmFzc2V0LCBudWxsLCAnXFx0JykgK1xuICAgICAgICAgICAgJ1xcblBvc3NpYmxlIHJlc29sdmVycyBhcmU6JyArXG4gICAgICAgICAgICBKU09OLnN0cmluZ2lmeShbJ2FuZHJvaWQnLCAnZ2VuZXJpYyddLCBudWxsLCAnXFx0JyksXG4gICAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gYWJzb2x1dGUgVVJMIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGZldGNoIHRoZSBhc3NldFxuICAgKiBmcm9tIHRoZSBkZXZzZXJ2ZXJcbiAgICovXG4gIGFzc2V0U2VydmVyVVJMKCk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIGludmFyaWFudCh0aGlzLnNlcnZlclVybCAhPSBudWxsLCAnbmVlZCBzZXJ2ZXIgdG8gbG9hZCBmcm9tJyk7XG4gICAgcmV0dXJuIHRoaXMuZnJvbVNvdXJjZShcbiAgICAgIHRoaXMuc2VydmVyVXJsICtcbiAgICAgICAgZ2V0U2NhbGVkQXNzZXRQYXRoKHRoaXMuYXNzZXQpICtcbiAgICAgICAgJz9wbGF0Zm9ybT0nICtcbiAgICAgICAgUGxhdGZvcm0uT1MgK1xuICAgICAgICAnJmhhc2g9JyArXG4gICAgICAgIHRoaXMuYXNzZXQuaGFzaCxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc29sdmVzIHRvIGp1c3QgdGhlIHNjYWxlZCBhc3NldCBmaWxlbmFtZVxuICAgKiBFLmcuICdhc3NldHMvQXdlc29tZU1vZHVsZS9pY29uQDJ4LnBuZydcbiAgICovXG4gIHNjYWxlZEFzc2V0UGF0aCgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICByZXR1cm4gdGhpcy5mcm9tU291cmNlKGdldFNjYWxlZEFzc2V0UGF0aCh0aGlzLmFzc2V0KSk7XG4gIH1cblxuICAvKipcbiAgICogUmVzb2x2ZXMgdG8gd2hlcmUgdGhlIGJ1bmRsZSBpcyBydW5uaW5nIGZyb20sIHdpdGggYSBzY2FsZWQgYXNzZXQgZmlsZW5hbWVcbiAgICogRS5nLiAnZmlsZTovLy9zZGNhcmQvYnVuZGxlL2Fzc2V0cy9Bd2Vzb21lTW9kdWxlL2ljb25AMngucG5nJ1xuICAgKi9cbiAgc2NhbGVkQXNzZXRVUkxOZWFyQnVuZGxlKCk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIGNvbnN0IHBhdGggPSB0aGlzLmpzYnVuZGxlVXJsID8/ICdmaWxlOi8vJztcbiAgICByZXR1cm4gdGhpcy5mcm9tU291cmNlKFxuICAgICAgLy8gQXNzZXRzIGNhbiBoYXZlIHJlbGF0aXZlIHBhdGhzIG91dHNpZGUgb2YgdGhlIHByb2plY3Qgcm9vdC5cbiAgICAgIC8vIFdoZW4gYnVuZGxpbmcgdGhlbSB3ZSByZXBsYWNlIGAuLi9gIHdpdGggYF9gIHRvIG1ha2Ugc3VyZSB0aGV5XG4gICAgICAvLyBkb24ndCBlbmQgdXAgb3V0c2lkZSBvZiB0aGUgZXhwZWN0ZWQgYXNzZXRzIGRpcmVjdG9yeS5cbiAgICAgIHBhdGggKyBnZXRTY2FsZWRBc3NldFBhdGgodGhpcy5hc3NldCkucmVwbGFjZSgvXFwuXFwuXFwvL2csICdfJyksXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgZGVmYXVsdCBsb2NhdGlvbiBvZiBhc3NldHMgYnVuZGxlZCB3aXRoIHRoZSBhcHAsIGxvY2F0ZWQgYnlcbiAgICogcmVzb3VyY2UgaWRlbnRpZmllclxuICAgKiBUaGUgQW5kcm9pZCByZXNvdXJjZSBzeXN0ZW0gcGlja3MgdGhlIGNvcnJlY3Qgc2NhbGUuXG4gICAqIEUuZy4gJ2Fzc2V0c19hd2Vzb21lbW9kdWxlX2ljb24nXG4gICAqL1xuICByZXNvdXJjZUlkZW50aWZpZXJXaXRob3V0U2NhbGUoKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJyxcbiAgICAgICdyZXNvdXJjZSBpZGVudGlmaWVycyB3b3JrIG9uIEFuZHJvaWQnLFxuICAgICk7XG4gICAgcmV0dXJuIHRoaXMuZnJvbVNvdXJjZShnZXRBbmRyb2lkUmVzb3VyY2VJZGVudGlmaWVyKHRoaXMuYXNzZXQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJZiB0aGUganNidW5kbGUgaXMgcnVubmluZyBmcm9tIGEgc2lkZWxvYWQgbG9jYXRpb24sIHRoaXMgcmVzb2x2ZXMgYXNzZXRzXG4gICAqIHJlbGF0aXZlIHRvIGl0cyBsb2NhdGlvblxuICAgKiBFLmcuICdmaWxlOi8vL3NkY2FyZC9Bd2Vzb21lTW9kdWxlL2RyYXdhYmxlLW1kcGkvaWNvbi5wbmcnXG4gICAqL1xuICBkcmF3YWJsZUZvbGRlckluQnVuZGxlKCk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIGNvbnN0IHBhdGggPSB0aGlzLmpzYnVuZGxlVXJsID8/ICdmaWxlOi8vJztcbiAgICByZXR1cm4gdGhpcy5mcm9tU291cmNlKHBhdGggKyBnZXRBc3NldFBhdGhJbkRyYXdhYmxlRm9sZGVyKHRoaXMuYXNzZXQpKTtcbiAgfVxuXG4gIGZyb21Tb3VyY2Uoc291cmNlOiBzdHJpbmcpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgX19wYWNrYWdlcl9hc3NldDogdHJ1ZSxcbiAgICAgIHdpZHRoOiB0aGlzLmFzc2V0LndpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLmFzc2V0LmhlaWdodCxcbiAgICAgIHVyaTogc291cmNlLFxuICAgICAgc2NhbGU6IHBpY2tTY2FsZSh0aGlzLmFzc2V0LnNjYWxlcywgUGl4ZWxSYXRpby5nZXQoKSksXG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBwaWNrU2NhbGU6IChzY2FsZXM6IEFycmF5PG51bWJlcj4sIGRldmljZVNjYWxlPzogbnVtYmVyKSA9PiBudW1iZXIgPVxuICAgIHBpY2tTY2FsZTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBc3NldFNvdXJjZVJlc29sdmVyO1xuIl0sIm1hcHBpbmdzIjoiQUFVQSxZQUFZOztBQUFDLElBQUFBLHNCQUFBLEdBQUFDLE9BQUE7QUFBQSxJQUFBQyxnQkFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQUEsSUFBQUUsYUFBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBZWIsSUFBTUcsVUFBVSxHQUFHSCxPQUFPLDBCQUEwQixDQUFDLENBQUNJLE9BQU87QUFDN0QsSUFBTUMsUUFBUSxHQUFHTCxPQUFPLHdCQUF3QixDQUFDO0FBQ2pELElBQUFNLFFBQUEsR0FBb0JOLE9BQU8sZUFBZSxDQUFDO0VBQXBDTyxTQUFTLEdBQUFELFFBQUEsQ0FBVEMsU0FBUztBQUNoQixJQUFBQyxTQUFBLEdBSUlSLE9BQU8sQ0FBQyw0Q0FBNEMsQ0FBQztFQUh2RFMsNEJBQTRCLEdBQUFELFNBQUEsQ0FBNUJDLDRCQUE0QjtFQUM1QkMsNEJBQTRCLEdBQUFGLFNBQUEsQ0FBNUJFLDRCQUE0QjtFQUM1QkMsV0FBVyxHQUFBSCxTQUFBLENBQVhHLFdBQVc7QUFFYixJQUFNQyxTQUFTLEdBQUdaLE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFLdEMsU0FBU2Esa0JBQWtCQSxDQUFDQyxLQUFvQixFQUFVO0VBQ3hELElBQU1DLEtBQUssR0FBR1IsU0FBUyxDQUFDTyxLQUFLLENBQUNFLE1BQU0sRUFBRWIsVUFBVSxDQUFDYyxHQUFHLENBQUMsQ0FBQyxDQUFDO0VBQ3ZELElBQU1DLFdBQVcsR0FBR0gsS0FBSyxLQUFLLENBQUMsR0FBRyxFQUFFLEdBQUcsR0FBRyxHQUFHQSxLQUFLLEdBQUcsR0FBRztFQUN4RCxJQUFNSSxRQUFRLEdBQUdSLFdBQVcsQ0FBQ0csS0FBSyxDQUFDO0VBQ25DLE9BQU9LLFFBQVEsR0FBRyxHQUFHLEdBQUdMLEtBQUssQ0FBQ00sSUFBSSxHQUFHRixXQUFXLEdBQUcsR0FBRyxHQUFHSixLQUFLLENBQUNPLElBQUk7QUFDckU7QUFLQSxTQUFTQyw0QkFBNEJBLENBQUNSLEtBQW9CLEVBQVU7RUFDbEUsSUFBTUMsS0FBSyxHQUFHUixTQUFTLENBQUNPLEtBQUssQ0FBQ0UsTUFBTSxFQUFFYixVQUFVLENBQUNjLEdBQUcsQ0FBQyxDQUFDLENBQUM7RUFDdkQsSUFBTU0sY0FBYyxHQUFHZCw0QkFBNEIsQ0FBQ0ssS0FBSyxFQUFFQyxLQUFLLENBQUM7RUFDakUsSUFBTVMsUUFBUSxHQUFHZCw0QkFBNEIsQ0FBQ0ksS0FBSyxDQUFDO0VBQ3BELE9BQU9TLGNBQWMsR0FBRyxHQUFHLEdBQUdDLFFBQVEsR0FBRyxHQUFHLEdBQUdWLEtBQUssQ0FBQ08sSUFBSTtBQUMzRDtBQWdCQSxTQUFTSSx5QkFBeUJBLENBQUNYLEtBQW9CLEVBQVc7RUFDaEUsT0FBTyxFQUFFQSxLQUFLLENBQUNPLElBQUksS0FBSyxLQUFLLElBQUloQixRQUFRLENBQUNxQixFQUFFLEtBQUssU0FBUyxDQUFDO0FBQzdEO0FBQUMsSUFFS0MsbUJBQW1CO0VBT3ZCLFNBQUFBLG9CQUFZQyxTQUFrQixFQUFFQyxXQUFvQixFQUFFZixLQUFvQixFQUFFO0lBQUEsSUFBQWIsZ0JBQUEsQ0FBQUcsT0FBQSxRQUFBdUIsbUJBQUE7SUFDMUUsSUFBSSxDQUFDQyxTQUFTLEdBQUdBLFNBQVM7SUFDMUIsSUFBSSxDQUFDQyxXQUFXLEdBQUdBLFdBQVc7SUFDOUIsSUFBSSxDQUFDZixLQUFLLEdBQUdBLEtBQUs7RUFDcEI7RUFBQyxXQUFBWixhQUFBLENBQUFFLE9BQUEsRUFBQXVCLG1CQUFBO0lBQUFHLEdBQUE7SUFBQUMsS0FBQSxFQUVELFNBQUFDLGtCQUFrQkEsQ0FBQSxFQUFZO01BQzVCLE9BQ0UsSUFBSSxDQUFDSixTQUFTLElBQUksSUFBSSxJQUN0QixJQUFJLENBQUNBLFNBQVMsS0FBSyxFQUFFLElBQ3JCSCx5QkFBeUIsQ0FBQyxJQUFJLENBQUNYLEtBQUssQ0FBQztJQUV6QztFQUFDO0lBQUFnQixHQUFBO0lBQUFDLEtBQUEsRUFFRCxTQUFBRSxzQkFBc0JBLENBQUEsRUFBWTtNQUFBLElBQUFDLGlCQUFBO01BQ2hDLE9BQU8sSUFBSSxDQUFDTCxXQUFXLElBQUksSUFBSSxNQUFBSyxpQkFBQSxHQUFJLElBQUksQ0FBQ0wsV0FBVyxxQkFBaEJLLGlCQUFBLENBQWtCQyxVQUFVLENBQUMsU0FBUyxDQUFDO0lBQzVFO0VBQUM7SUFBQUwsR0FBQTtJQUFBQyxLQUFBLEVBRUQsU0FBQUssWUFBWUEsQ0FBQSxFQUF3QjtNQUNsQyxJQUFJLElBQUksQ0FBQ0osa0JBQWtCLENBQUMsQ0FBQyxFQUFFO1FBQzdCLE9BQU8sSUFBSSxDQUFDSyxjQUFjLENBQUMsQ0FBQztNQUM5QjtNQUVBLElBQUksSUFBSSxDQUFDdkIsS0FBSyxDQUFDd0IsUUFBUSxJQUFJLElBQUksRUFBRTtRQUMvQixPQUFPLElBQUksQ0FBQ0MscUJBQXFCLENBQUMsSUFBSSxDQUFDekIsS0FBSyxDQUFDd0IsUUFBUSxDQUFDO01BQ3hEO01BRUEsSUFBSWpDLFFBQVEsQ0FBQ3FCLEVBQUUsS0FBSyxTQUFTLEVBQUU7UUFDN0IsT0FBTyxJQUFJLENBQUNPLHNCQUFzQixDQUFDLENBQUMsR0FDaEMsSUFBSSxDQUFDTyxzQkFBc0IsQ0FBQyxDQUFDLEdBQzdCLElBQUksQ0FBQ0MsOEJBQThCLENBQUMsQ0FBQztNQUMzQyxDQUFDLE1BQU07UUFDTCxPQUFPLElBQUksQ0FBQ0Msd0JBQXdCLENBQUMsQ0FBQztNQUN4QztJQUNGO0VBQUM7SUFBQVosR0FBQTtJQUFBQyxLQUFBLEVBRUQsU0FBQVEscUJBQXFCQSxDQUFDRCxRQUErQixFQUF1QjtNQUMxRSxRQUFRQSxRQUFRO1FBQ2QsS0FBSyxTQUFTO1VBQ1osT0FBTyxJQUFJLENBQUNMLHNCQUFzQixDQUFDLENBQUMsR0FDaEMsSUFBSSxDQUFDTyxzQkFBc0IsQ0FBQyxDQUFDLEdBQzdCLElBQUksQ0FBQ0MsOEJBQThCLENBQUMsQ0FBQztRQUMzQyxLQUFLLFNBQVM7VUFDWixPQUFPLElBQUksQ0FBQ0Msd0JBQXdCLENBQUMsQ0FBQztRQUN4QztVQUNFLE1BQU0sSUFBSUMsS0FBSyxDQUNiLHFEQUFxRCxHQUNuREwsUUFBUSxHQUNSLFdBQVcsR0FDWE0sSUFBSSxDQUFDQyxTQUFTLENBQUMsSUFBSSxDQUFDL0IsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsR0FDdEMsMkJBQTJCLEdBQzNCOEIsSUFBSSxDQUFDQyxTQUFTLENBQUMsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FDckQsQ0FBQztNQUNMO0lBQ0Y7RUFBQztJQUFBZixHQUFBO0lBQUFDLEtBQUEsRUFNRCxTQUFBTSxjQUFjQSxDQUFBLEVBQXdCO01BQ3BDekIsU0FBUyxDQUFDLElBQUksQ0FBQ2dCLFNBQVMsSUFBSSxJQUFJLEVBQUUsMEJBQTBCLENBQUM7TUFDN0QsT0FBTyxJQUFJLENBQUNrQixVQUFVLENBQ3BCLElBQUksQ0FBQ2xCLFNBQVMsR0FDWmYsa0JBQWtCLENBQUMsSUFBSSxDQUFDQyxLQUFLLENBQUMsR0FDOUIsWUFBWSxHQUNaVCxRQUFRLENBQUNxQixFQUFFLEdBQ1gsUUFBUSxHQUNSLElBQUksQ0FBQ1osS0FBSyxDQUFDaUMsSUFDZixDQUFDO0lBQ0g7RUFBQztJQUFBakIsR0FBQTtJQUFBQyxLQUFBLEVBTUQsU0FBQWlCLGVBQWVBLENBQUEsRUFBd0I7TUFDckMsT0FBTyxJQUFJLENBQUNGLFVBQVUsQ0FBQ2pDLGtCQUFrQixDQUFDLElBQUksQ0FBQ0MsS0FBSyxDQUFDLENBQUM7SUFDeEQ7RUFBQztJQUFBZ0IsR0FBQTtJQUFBQyxLQUFBLEVBTUQsU0FBQVcsd0JBQXdCQSxDQUFBLEVBQXdCO01BQUEsSUFBQU8sa0JBQUE7TUFDOUMsSUFBTUMsSUFBSSxJQUFBRCxrQkFBQSxHQUFHLElBQUksQ0FBQ3BCLFdBQVcsWUFBQW9CLGtCQUFBLEdBQUksU0FBUztNQUMxQyxPQUFPLElBQUksQ0FBQ0gsVUFBVSxDQUlwQkksSUFBSSxHQUFHckMsa0JBQWtCLENBQUMsSUFBSSxDQUFDQyxLQUFLLENBQUMsQ0FBQ3FDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUM5RCxDQUFDO0lBQ0g7RUFBQztJQUFBckIsR0FBQTtJQUFBQyxLQUFBLEVBUUQsU0FBQVUsOEJBQThCQSxDQUFBLEVBQXdCO01BQ3BEN0IsU0FBUyxDQUNQUCxRQUFRLENBQUNxQixFQUFFLEtBQUssU0FBUyxFQUN6QixzQ0FDRixDQUFDO01BQ0QsT0FBTyxJQUFJLENBQUNvQixVQUFVLENBQUNwQyw0QkFBNEIsQ0FBQyxJQUFJLENBQUNJLEtBQUssQ0FBQyxDQUFDO0lBQ2xFO0VBQUM7SUFBQWdCLEdBQUE7SUFBQUMsS0FBQSxFQU9ELFNBQUFTLHNCQUFzQkEsQ0FBQSxFQUF3QjtNQUFBLElBQUFZLGtCQUFBO01BQzVDLElBQU1GLElBQUksSUFBQUUsa0JBQUEsR0FBRyxJQUFJLENBQUN2QixXQUFXLFlBQUF1QixrQkFBQSxHQUFJLFNBQVM7TUFDMUMsT0FBTyxJQUFJLENBQUNOLFVBQVUsQ0FBQ0ksSUFBSSxHQUFHNUIsNEJBQTRCLENBQUMsSUFBSSxDQUFDUixLQUFLLENBQUMsQ0FBQztJQUN6RTtFQUFDO0lBQUFnQixHQUFBO0lBQUFDLEtBQUEsRUFFRCxTQUFBZSxVQUFVQSxDQUFDTyxNQUFjLEVBQXVCO01BQzlDLE9BQU87UUFDTEMsZ0JBQWdCLEVBQUUsSUFBSTtRQUN0QkMsS0FBSyxFQUFFLElBQUksQ0FBQ3pDLEtBQUssQ0FBQ3lDLEtBQUs7UUFDdkJDLE1BQU0sRUFBRSxJQUFJLENBQUMxQyxLQUFLLENBQUMwQyxNQUFNO1FBQ3pCQyxHQUFHLEVBQUVKLE1BQU07UUFDWHRDLEtBQUssRUFBRVIsU0FBUyxDQUFDLElBQUksQ0FBQ08sS0FBSyxDQUFDRSxNQUFNLEVBQUViLFVBQVUsQ0FBQ2MsR0FBRyxDQUFDLENBQUM7TUFDdEQsQ0FBQztJQUNIO0VBQUM7QUFBQTtBQXJJR1UsbUJBQW1CLENBdUloQnBCLFNBQVMsR0FDZEEsU0FBUztBQUdibUQsTUFBTSxDQUFDQyxPQUFPLEdBQUdoQyxtQkFBbUIiLCJpZ25vcmVMaXN0IjpbXX0=