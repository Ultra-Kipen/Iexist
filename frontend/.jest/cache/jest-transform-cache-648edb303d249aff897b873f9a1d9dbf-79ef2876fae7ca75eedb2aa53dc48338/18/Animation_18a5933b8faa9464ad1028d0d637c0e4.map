{"version":3,"names":["_NativeAnimatedHelper","_interopRequireDefault","require","ReactNativeFeatureFlags","_interopRequireWildcard","_AnimatedProps","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","startNativeAnimationNextId","_nativeID","_classPrivateFieldLooseKey2","_onEnd","_useNativeDriver","Animation","exports","config","_config$isInteraction","_config$iterations","_classCallCheck2","writable","value","_classPrivateFieldLooseBase2","NativeAnimatedHelper","shouldUseNativeDriver","__active","__isInteraction","isInteraction","__isLooping","isLooping","__iterations","iterations","__debugID","debugID","_createClass2","key","start","fromValue","onUpdate","onEnd","previousAnimation","animatedValue","__isNative","Error","stop","nativeID","identifier","API","setWaitingForIdentifier","stopAnimation","unsetWaitingForIdentifier","__getNativeAnimationConfig","__findAnimatedPropsNodes","node","result","AnimatedProps","push","child","__getChildren","apply","_toConsumableArray2","__startAnimationIfNative","_this","startNativeAnimationWaitId","__makeNative","platformConfig","generateNewAnimationId","startAnimatingNode","__getNativeTag","__notifyAnimationEnd","__onAnimatedValueUpdateReceived","shouldSkipStateUpdatesForLoopingAnimations","forEach","update","callback","__getDebugID","undefined"],"sources":["Animation.js"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict-local\n * @format\n */\n\nimport type {PlatformConfig} from '../AnimatedPlatformConfig';\nimport type AnimatedNode from '../nodes/AnimatedNode';\nimport type AnimatedValue from '../nodes/AnimatedValue';\n\nimport NativeAnimatedHelper from '../../../src/private/animated/NativeAnimatedHelper';\nimport * as ReactNativeFeatureFlags from '../../../src/private/featureflags/ReactNativeFeatureFlags';\nimport AnimatedProps from '../nodes/AnimatedProps';\n\nexport type EndResult = {finished: boolean, value?: number, ...};\nexport type EndCallback = (result: EndResult) => void;\n\nexport type AnimationConfig = $ReadOnly<{\n  isInteraction?: boolean,\n  useNativeDriver: boolean,\n  platformConfig?: PlatformConfig,\n  onComplete?: ?EndCallback,\n  iterations?: number,\n  isLooping?: boolean,\n  debugID?: ?string,\n  ...\n}>;\n\nlet startNativeAnimationNextId = 1;\n\n// Important note: start() and stop() will only be called at most once.\n// Once an animation has been stopped or finished its course, it will\n// not be reused.\nexport default class Animation {\n  #nativeID: ?number;\n  #onEnd: ?EndCallback;\n  #useNativeDriver: boolean;\n\n  __active: boolean;\n  __isInteraction: boolean;\n  __isLooping: ?boolean;\n  __iterations: number;\n  __debugID: ?string;\n\n  constructor(config: AnimationConfig) {\n    this.#useNativeDriver = NativeAnimatedHelper.shouldUseNativeDriver(config);\n\n    this.__active = false;\n    this.__isInteraction = config.isInteraction ?? !this.#useNativeDriver;\n    this.__isLooping = config.isLooping;\n    this.__iterations = config.iterations ?? 1;\n    if (__DEV__) {\n      this.__debugID = config.debugID;\n    }\n  }\n\n  start(\n    fromValue: number,\n    onUpdate: (value: number) => void,\n    onEnd: ?EndCallback,\n    previousAnimation: ?Animation,\n    animatedValue: AnimatedValue,\n  ): void {\n    if (!this.#useNativeDriver && animatedValue.__isNative === true) {\n      throw new Error(\n        'Attempting to run JS driven animation on animated node ' +\n          'that has been moved to \"native\" earlier by starting an ' +\n          'animation with `useNativeDriver: true`',\n      );\n    }\n\n    this.#onEnd = onEnd;\n    this.__active = true;\n  }\n\n  stop(): void {\n    if (this.#nativeID != null) {\n      const nativeID = this.#nativeID;\n      const identifier = `${nativeID}:stopAnimation`;\n      try {\n        // This is only required when singleOpBatching is used, as otherwise\n        // we flush calls immediately when there's no pending queue.\n        NativeAnimatedHelper.API.setWaitingForIdentifier(identifier);\n        NativeAnimatedHelper.API.stopAnimation(nativeID);\n      } finally {\n        NativeAnimatedHelper.API.unsetWaitingForIdentifier(identifier);\n      }\n    }\n    this.__active = false;\n  }\n\n  __getNativeAnimationConfig(): $ReadOnly<{\n    platformConfig: ?PlatformConfig,\n    ...\n  }> {\n    // Subclasses that have corresponding animation implementation done in native\n    // should override this method\n    throw new Error('This animation type cannot be offloaded to native');\n  }\n\n  __findAnimatedPropsNodes(node: AnimatedNode): Array<AnimatedProps> {\n    const result = [];\n\n    if (node instanceof AnimatedProps) {\n      result.push(node);\n      return result;\n    }\n\n    for (const child of node.__getChildren()) {\n      result.push(...this.__findAnimatedPropsNodes(child));\n    }\n\n    return result;\n  }\n\n  __startAnimationIfNative(animatedValue: AnimatedValue): boolean {\n    if (!this.#useNativeDriver) {\n      return false;\n    }\n\n    const startNativeAnimationWaitId = `${startNativeAnimationNextId}:startAnimation`;\n    startNativeAnimationNextId += 1;\n    NativeAnimatedHelper.API.setWaitingForIdentifier(\n      startNativeAnimationWaitId,\n    );\n    try {\n      const config = this.__getNativeAnimationConfig();\n      animatedValue.__makeNative(config.platformConfig);\n      this.#nativeID = NativeAnimatedHelper.generateNewAnimationId();\n      NativeAnimatedHelper.API.startAnimatingNode(\n        this.#nativeID,\n        animatedValue.__getNativeTag(),\n        config,\n        result => {\n          this.__notifyAnimationEnd(result);\n\n          // When using natively driven animations, once the animation completes,\n          // we need to ensure that the JS side nodes are synced with the updated\n          // values.\n          const {value} = result;\n          if (value != null) {\n            animatedValue.__onAnimatedValueUpdateReceived(value);\n\n            if (\n              ReactNativeFeatureFlags.shouldSkipStateUpdatesForLoopingAnimations() &&\n              this.__isLooping === true\n            ) {\n              return;\n            }\n\n            // Once the JS side node is synced with the updated values, trigger an\n            // update on the AnimatedProps nodes to call any registered callbacks.\n            this.__findAnimatedPropsNodes(animatedValue).forEach(node =>\n              node.update(),\n            );\n          }\n        },\n      );\n\n      return true;\n    } catch (e) {\n      throw e;\n    } finally {\n      NativeAnimatedHelper.API.unsetWaitingForIdentifier(\n        startNativeAnimationWaitId,\n      );\n    }\n  }\n\n  /**\n   * Notify the completion callback that the animation has ended. The completion\n   * callback will never be called more than once.\n   */\n  __notifyAnimationEnd(result: EndResult): void {\n    const callback = this.#onEnd;\n    if (callback != null) {\n      this.#onEnd = null;\n      callback(result);\n    }\n  }\n\n  __getDebugID(): ?string {\n    if (__DEV__) {\n      return this.__debugID;\n    }\n    return undefined;\n  }\n}\n"],"mappings":"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","ignoreList":[]}