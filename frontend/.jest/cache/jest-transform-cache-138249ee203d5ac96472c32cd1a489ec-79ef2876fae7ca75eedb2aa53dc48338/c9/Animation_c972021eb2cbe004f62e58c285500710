ae1b76ff993894f7bc09370fc41b8d9f
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _classPrivateFieldLooseBase2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseBase"));
var _classPrivateFieldLooseKey2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseKey"));
var _NativeAnimatedHelper = _interopRequireDefault(require("../../../src/private/animated/NativeAnimatedHelper"));
var ReactNativeFeatureFlags = _interopRequireWildcard(require("../../../src/private/featureflags/ReactNativeFeatureFlags"));
var _AnimatedProps = _interopRequireDefault(require("../nodes/AnimatedProps"));
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
var startNativeAnimationNextId = 1;
var _nativeID = (0, _classPrivateFieldLooseKey2.default)("nativeID");
var _onEnd = (0, _classPrivateFieldLooseKey2.default)("onEnd");
var _useNativeDriver = (0, _classPrivateFieldLooseKey2.default)("useNativeDriver");
var Animation = exports.default = function () {
  function Animation(config) {
    var _config$isInteraction, _config$iterations;
    (0, _classCallCheck2.default)(this, Animation);
    Object.defineProperty(this, _nativeID, {
      writable: true,
      value: void 0
    });
    Object.defineProperty(this, _onEnd, {
      writable: true,
      value: void 0
    });
    Object.defineProperty(this, _useNativeDriver, {
      writable: true,
      value: void 0
    });
    (0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver] = _NativeAnimatedHelper.default.shouldUseNativeDriver(config);
    this.__active = false;
    this.__isInteraction = (_config$isInteraction = config.isInteraction) != null ? _config$isInteraction : !(0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver];
    this.__isLooping = config.isLooping;
    this.__iterations = (_config$iterations = config.iterations) != null ? _config$iterations : 1;
    if (__DEV__) {
      this.__debugID = config.debugID;
    }
  }
  return (0, _createClass2.default)(Animation, [{
    key: "start",
    value: function start(fromValue, onUpdate, onEnd, previousAnimation, animatedValue) {
      if (!(0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver] && animatedValue.__isNative === true) {
        throw new Error('Attempting to run JS driven animation on animated node ' + 'that has been moved to "native" earlier by starting an ' + 'animation with `useNativeDriver: true`');
      }
      (0, _classPrivateFieldLooseBase2.default)(this, _onEnd)[_onEnd] = onEnd;
      this.__active = true;
    }
  }, {
    key: "stop",
    value: function stop() {
      if ((0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID] != null) {
        var nativeID = (0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID];
        var identifier = `${nativeID}:stopAnimation`;
        try {
          _NativeAnimatedHelper.default.API.setWaitingForIdentifier(identifier);
          _NativeAnimatedHelper.default.API.stopAnimation(nativeID);
        } finally {
          _NativeAnimatedHelper.default.API.unsetWaitingForIdentifier(identifier);
        }
      }
      this.__active = false;
    }
  }, {
    key: "__getNativeAnimationConfig",
    value: function __getNativeAnimationConfig() {
      throw new Error('This animation type cannot be offloaded to native');
    }
  }, {
    key: "__findAnimatedPropsNodes",
    value: function __findAnimatedPropsNodes(node) {
      var result = [];
      if (node instanceof _AnimatedProps.default) {
        result.push(node);
        return result;
      }
      for (var child of node.__getChildren()) {
        result.push.apply(result, (0, _toConsumableArray2.default)(this.__findAnimatedPropsNodes(child)));
      }
      return result;
    }
  }, {
    key: "__startAnimationIfNative",
    value: function __startAnimationIfNative(animatedValue) {
      var _this = this;
      if (!(0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver]) {
        return false;
      }
      var startNativeAnimationWaitId = `${startNativeAnimationNextId}:startAnimation`;
      startNativeAnimationNextId += 1;
      _NativeAnimatedHelper.default.API.setWaitingForIdentifier(startNativeAnimationWaitId);
      try {
        var config = this.__getNativeAnimationConfig();
        animatedValue.__makeNative(config.platformConfig);
        (0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID] = _NativeAnimatedHelper.default.generateNewAnimationId();
        _NativeAnimatedHelper.default.API.startAnimatingNode((0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID], animatedValue.__getNativeTag(), config, function (result) {
          _this.__notifyAnimationEnd(result);
          var value = result.value;
          if (value != null) {
            animatedValue.__onAnimatedValueUpdateReceived(value);
            if (ReactNativeFeatureFlags.shouldSkipStateUpdatesForLoopingAnimations() && _this.__isLooping === true) {
              return;
            }
            _this.__findAnimatedPropsNodes(animatedValue).forEach(function (node) {
              return node.update();
            });
          }
        });
        return true;
      } catch (e) {
        throw e;
      } finally {
        _NativeAnimatedHelper.default.API.unsetWaitingForIdentifier(startNativeAnimationWaitId);
      }
    }
  }, {
    key: "__notifyAnimationEnd",
    value: function __notifyAnimationEnd(result) {
      var callback = (0, _classPrivateFieldLooseBase2.default)(this, _onEnd)[_onEnd];
      if (callback != null) {
        (0, _classPrivateFieldLooseBase2.default)(this, _onEnd)[_onEnd] = null;
        callback(result);
      }
    }
  }, {
    key: "__getDebugID",
    value: function __getDebugID() {
      if (__DEV__) {
        return this.__debugID;
      }
      return undefined;
    }
  }]);
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIlJlYWN0TmF0aXZlRmVhdHVyZUZsYWdzIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfQW5pbWF0ZWRQcm9wcyIsIl9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSIsImUiLCJXZWFrTWFwIiwiciIsInQiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImhhcyIsImdldCIsIm4iLCJfX3Byb3RvX18iLCJhIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJ1IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiaSIsInNldCIsInN0YXJ0TmF0aXZlQW5pbWF0aW9uTmV4dElkIiwiX25hdGl2ZUlEIiwiX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkyIiwiX29uRW5kIiwiX3VzZU5hdGl2ZURyaXZlciIsIkFuaW1hdGlvbiIsImV4cG9ydHMiLCJjb25maWciLCJfY29uZmlnJGlzSW50ZXJhY3Rpb24iLCJfY29uZmlnJGl0ZXJhdGlvbnMiLCJfY2xhc3NDYWxsQ2hlY2syIiwid3JpdGFibGUiLCJ2YWx1ZSIsIl9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZTIiLCJOYXRpdmVBbmltYXRlZEhlbHBlciIsInNob3VsZFVzZU5hdGl2ZURyaXZlciIsIl9fYWN0aXZlIiwiX19pc0ludGVyYWN0aW9uIiwiaXNJbnRlcmFjdGlvbiIsIl9faXNMb29waW5nIiwiaXNMb29waW5nIiwiX19pdGVyYXRpb25zIiwiaXRlcmF0aW9ucyIsIl9fREVWX18iLCJfX2RlYnVnSUQiLCJkZWJ1Z0lEIiwiX2NyZWF0ZUNsYXNzMiIsImtleSIsInN0YXJ0IiwiZnJvbVZhbHVlIiwib25VcGRhdGUiLCJvbkVuZCIsInByZXZpb3VzQW5pbWF0aW9uIiwiYW5pbWF0ZWRWYWx1ZSIsIl9faXNOYXRpdmUiLCJFcnJvciIsInN0b3AiLCJuYXRpdmVJRCIsImlkZW50aWZpZXIiLCJBUEkiLCJzZXRXYWl0aW5nRm9ySWRlbnRpZmllciIsInN0b3BBbmltYXRpb24iLCJ1bnNldFdhaXRpbmdGb3JJZGVudGlmaWVyIiwiX19nZXROYXRpdmVBbmltYXRpb25Db25maWciLCJfX2ZpbmRBbmltYXRlZFByb3BzTm9kZXMiLCJub2RlIiwicmVzdWx0IiwiQW5pbWF0ZWRQcm9wcyIsInB1c2giLCJjaGlsZCIsIl9fZ2V0Q2hpbGRyZW4iLCJhcHBseSIsIl90b0NvbnN1bWFibGVBcnJheTIiLCJfX3N0YXJ0QW5pbWF0aW9uSWZOYXRpdmUiLCJfdGhpcyIsInN0YXJ0TmF0aXZlQW5pbWF0aW9uV2FpdElkIiwiX19tYWtlTmF0aXZlIiwicGxhdGZvcm1Db25maWciLCJnZW5lcmF0ZU5ld0FuaW1hdGlvbklkIiwic3RhcnRBbmltYXRpbmdOb2RlIiwiX19nZXROYXRpdmVUYWciLCJfX25vdGlmeUFuaW1hdGlvbkVuZCIsIl9fb25BbmltYXRlZFZhbHVlVXBkYXRlUmVjZWl2ZWQiLCJzaG91bGRTa2lwU3RhdGVVcGRhdGVzRm9yTG9vcGluZ0FuaW1hdGlvbnMiLCJmb3JFYWNoIiwidXBkYXRlIiwiY2FsbGJhY2siLCJfX2dldERlYnVnSUQiLCJ1bmRlZmluZWQiXSwic291cmNlcyI6WyJBbmltYXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIE1ldGEgUGxhdGZvcm1zLCBJbmMuIGFuZCBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93IHN0cmljdC1sb2NhbFxuICogQGZvcm1hdFxuICovXG5cbmltcG9ydCB0eXBlIHtQbGF0Zm9ybUNvbmZpZ30gZnJvbSAnLi4vQW5pbWF0ZWRQbGF0Zm9ybUNvbmZpZyc7XG5pbXBvcnQgdHlwZSBBbmltYXRlZE5vZGUgZnJvbSAnLi4vbm9kZXMvQW5pbWF0ZWROb2RlJztcbmltcG9ydCB0eXBlIEFuaW1hdGVkVmFsdWUgZnJvbSAnLi4vbm9kZXMvQW5pbWF0ZWRWYWx1ZSc7XG5cbmltcG9ydCBOYXRpdmVBbmltYXRlZEhlbHBlciBmcm9tICcuLi8uLi8uLi9zcmMvcHJpdmF0ZS9hbmltYXRlZC9OYXRpdmVBbmltYXRlZEhlbHBlcic7XG5pbXBvcnQgKiBhcyBSZWFjdE5hdGl2ZUZlYXR1cmVGbGFncyBmcm9tICcuLi8uLi8uLi9zcmMvcHJpdmF0ZS9mZWF0dXJlZmxhZ3MvUmVhY3ROYXRpdmVGZWF0dXJlRmxhZ3MnO1xuaW1wb3J0IEFuaW1hdGVkUHJvcHMgZnJvbSAnLi4vbm9kZXMvQW5pbWF0ZWRQcm9wcyc7XG5cbmV4cG9ydCB0eXBlIEVuZFJlc3VsdCA9IHtmaW5pc2hlZDogYm9vbGVhbiwgdmFsdWU/OiBudW1iZXIsIC4uLn07XG5leHBvcnQgdHlwZSBFbmRDYWxsYmFjayA9IChyZXN1bHQ6IEVuZFJlc3VsdCkgPT4gdm9pZDtcblxuZXhwb3J0IHR5cGUgQW5pbWF0aW9uQ29uZmlnID0gJFJlYWRPbmx5PHtcbiAgaXNJbnRlcmFjdGlvbj86IGJvb2xlYW4sXG4gIHVzZU5hdGl2ZURyaXZlcjogYm9vbGVhbixcbiAgcGxhdGZvcm1Db25maWc/OiBQbGF0Zm9ybUNvbmZpZyxcbiAgb25Db21wbGV0ZT86ID9FbmRDYWxsYmFjayxcbiAgaXRlcmF0aW9ucz86IG51bWJlcixcbiAgaXNMb29waW5nPzogYm9vbGVhbixcbiAgZGVidWdJRD86ID9zdHJpbmcsXG4gIC4uLlxufT47XG5cbmxldCBzdGFydE5hdGl2ZUFuaW1hdGlvbk5leHRJZCA9IDE7XG5cbi8vIEltcG9ydGFudCBub3RlOiBzdGFydCgpIGFuZCBzdG9wKCkgd2lsbCBvbmx5IGJlIGNhbGxlZCBhdCBtb3N0IG9uY2UuXG4vLyBPbmNlIGFuIGFuaW1hdGlvbiBoYXMgYmVlbiBzdG9wcGVkIG9yIGZpbmlzaGVkIGl0cyBjb3Vyc2UsIGl0IHdpbGxcbi8vIG5vdCBiZSByZXVzZWQuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBbmltYXRpb24ge1xuICAjbmF0aXZlSUQ6ID9udW1iZXI7XG4gICNvbkVuZDogP0VuZENhbGxiYWNrO1xuICAjdXNlTmF0aXZlRHJpdmVyOiBib29sZWFuO1xuXG4gIF9fYWN0aXZlOiBib29sZWFuO1xuICBfX2lzSW50ZXJhY3Rpb246IGJvb2xlYW47XG4gIF9faXNMb29waW5nOiA/Ym9vbGVhbjtcbiAgX19pdGVyYXRpb25zOiBudW1iZXI7XG4gIF9fZGVidWdJRDogP3N0cmluZztcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IEFuaW1hdGlvbkNvbmZpZykge1xuICAgIHRoaXMuI3VzZU5hdGl2ZURyaXZlciA9IE5hdGl2ZUFuaW1hdGVkSGVscGVyLnNob3VsZFVzZU5hdGl2ZURyaXZlcihjb25maWcpO1xuXG4gICAgdGhpcy5fX2FjdGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMuX19pc0ludGVyYWN0aW9uID0gY29uZmlnLmlzSW50ZXJhY3Rpb24gPz8gIXRoaXMuI3VzZU5hdGl2ZURyaXZlcjtcbiAgICB0aGlzLl9faXNMb29waW5nID0gY29uZmlnLmlzTG9vcGluZztcbiAgICB0aGlzLl9faXRlcmF0aW9ucyA9IGNvbmZpZy5pdGVyYXRpb25zID8/IDE7XG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIHRoaXMuX19kZWJ1Z0lEID0gY29uZmlnLmRlYnVnSUQ7XG4gICAgfVxuICB9XG5cbiAgc3RhcnQoXG4gICAgZnJvbVZhbHVlOiBudW1iZXIsXG4gICAgb25VcGRhdGU6ICh2YWx1ZTogbnVtYmVyKSA9PiB2b2lkLFxuICAgIG9uRW5kOiA/RW5kQ2FsbGJhY2ssXG4gICAgcHJldmlvdXNBbmltYXRpb246ID9BbmltYXRpb24sXG4gICAgYW5pbWF0ZWRWYWx1ZTogQW5pbWF0ZWRWYWx1ZSxcbiAgKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLiN1c2VOYXRpdmVEcml2ZXIgJiYgYW5pbWF0ZWRWYWx1ZS5fX2lzTmF0aXZlID09PSB0cnVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdBdHRlbXB0aW5nIHRvIHJ1biBKUyBkcml2ZW4gYW5pbWF0aW9uIG9uIGFuaW1hdGVkIG5vZGUgJyArXG4gICAgICAgICAgJ3RoYXQgaGFzIGJlZW4gbW92ZWQgdG8gXCJuYXRpdmVcIiBlYXJsaWVyIGJ5IHN0YXJ0aW5nIGFuICcgK1xuICAgICAgICAgICdhbmltYXRpb24gd2l0aCBgdXNlTmF0aXZlRHJpdmVyOiB0cnVlYCcsXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuI29uRW5kID0gb25FbmQ7XG4gICAgdGhpcy5fX2FjdGl2ZSA9IHRydWU7XG4gIH1cblxuICBzdG9wKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLiNuYXRpdmVJRCAhPSBudWxsKSB7XG4gICAgICBjb25zdCBuYXRpdmVJRCA9IHRoaXMuI25hdGl2ZUlEO1xuICAgICAgY29uc3QgaWRlbnRpZmllciA9IGAke25hdGl2ZUlEfTpzdG9wQW5pbWF0aW9uYDtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIFRoaXMgaXMgb25seSByZXF1aXJlZCB3aGVuIHNpbmdsZU9wQmF0Y2hpbmcgaXMgdXNlZCwgYXMgb3RoZXJ3aXNlXG4gICAgICAgIC8vIHdlIGZsdXNoIGNhbGxzIGltbWVkaWF0ZWx5IHdoZW4gdGhlcmUncyBubyBwZW5kaW5nIHF1ZXVlLlxuICAgICAgICBOYXRpdmVBbmltYXRlZEhlbHBlci5BUEkuc2V0V2FpdGluZ0ZvcklkZW50aWZpZXIoaWRlbnRpZmllcik7XG4gICAgICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSS5zdG9wQW5pbWF0aW9uKG5hdGl2ZUlEKTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSS51bnNldFdhaXRpbmdGb3JJZGVudGlmaWVyKGlkZW50aWZpZXIpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLl9fYWN0aXZlID0gZmFsc2U7XG4gIH1cblxuICBfX2dldE5hdGl2ZUFuaW1hdGlvbkNvbmZpZygpOiAkUmVhZE9ubHk8e1xuICAgIHBsYXRmb3JtQ29uZmlnOiA/UGxhdGZvcm1Db25maWcsXG4gICAgLi4uXG4gIH0+IHtcbiAgICAvLyBTdWJjbGFzc2VzIHRoYXQgaGF2ZSBjb3JyZXNwb25kaW5nIGFuaW1hdGlvbiBpbXBsZW1lbnRhdGlvbiBkb25lIGluIG5hdGl2ZVxuICAgIC8vIHNob3VsZCBvdmVycmlkZSB0aGlzIG1ldGhvZFxuICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBhbmltYXRpb24gdHlwZSBjYW5ub3QgYmUgb2ZmbG9hZGVkIHRvIG5hdGl2ZScpO1xuICB9XG5cbiAgX19maW5kQW5pbWF0ZWRQcm9wc05vZGVzKG5vZGU6IEFuaW1hdGVkTm9kZSk6IEFycmF5PEFuaW1hdGVkUHJvcHM+IHtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcblxuICAgIGlmIChub2RlIGluc3RhbmNlb2YgQW5pbWF0ZWRQcm9wcykge1xuICAgICAgcmVzdWx0LnB1c2gobm9kZSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygbm9kZS5fX2dldENoaWxkcmVuKCkpIHtcbiAgICAgIHJlc3VsdC5wdXNoKC4uLnRoaXMuX19maW5kQW5pbWF0ZWRQcm9wc05vZGVzKGNoaWxkKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIF9fc3RhcnRBbmltYXRpb25JZk5hdGl2ZShhbmltYXRlZFZhbHVlOiBBbmltYXRlZFZhbHVlKTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLiN1c2VOYXRpdmVEcml2ZXIpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBzdGFydE5hdGl2ZUFuaW1hdGlvbldhaXRJZCA9IGAke3N0YXJ0TmF0aXZlQW5pbWF0aW9uTmV4dElkfTpzdGFydEFuaW1hdGlvbmA7XG4gICAgc3RhcnROYXRpdmVBbmltYXRpb25OZXh0SWQgKz0gMTtcbiAgICBOYXRpdmVBbmltYXRlZEhlbHBlci5BUEkuc2V0V2FpdGluZ0ZvcklkZW50aWZpZXIoXG4gICAgICBzdGFydE5hdGl2ZUFuaW1hdGlvbldhaXRJZCxcbiAgICApO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb25maWcgPSB0aGlzLl9fZ2V0TmF0aXZlQW5pbWF0aW9uQ29uZmlnKCk7XG4gICAgICBhbmltYXRlZFZhbHVlLl9fbWFrZU5hdGl2ZShjb25maWcucGxhdGZvcm1Db25maWcpO1xuICAgICAgdGhpcy4jbmF0aXZlSUQgPSBOYXRpdmVBbmltYXRlZEhlbHBlci5nZW5lcmF0ZU5ld0FuaW1hdGlvbklkKCk7XG4gICAgICBOYXRpdmVBbmltYXRlZEhlbHBlci5BUEkuc3RhcnRBbmltYXRpbmdOb2RlKFxuICAgICAgICB0aGlzLiNuYXRpdmVJRCxcbiAgICAgICAgYW5pbWF0ZWRWYWx1ZS5fX2dldE5hdGl2ZVRhZygpLFxuICAgICAgICBjb25maWcsXG4gICAgICAgIHJlc3VsdCA9PiB7XG4gICAgICAgICAgdGhpcy5fX25vdGlmeUFuaW1hdGlvbkVuZChyZXN1bHQpO1xuXG4gICAgICAgICAgLy8gV2hlbiB1c2luZyBuYXRpdmVseSBkcml2ZW4gYW5pbWF0aW9ucywgb25jZSB0aGUgYW5pbWF0aW9uIGNvbXBsZXRlcyxcbiAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGVuc3VyZSB0aGF0IHRoZSBKUyBzaWRlIG5vZGVzIGFyZSBzeW5jZWQgd2l0aCB0aGUgdXBkYXRlZFxuICAgICAgICAgIC8vIHZhbHVlcy5cbiAgICAgICAgICBjb25zdCB7dmFsdWV9ID0gcmVzdWx0O1xuICAgICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7XG4gICAgICAgICAgICBhbmltYXRlZFZhbHVlLl9fb25BbmltYXRlZFZhbHVlVXBkYXRlUmVjZWl2ZWQodmFsdWUpO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIFJlYWN0TmF0aXZlRmVhdHVyZUZsYWdzLnNob3VsZFNraXBTdGF0ZVVwZGF0ZXNGb3JMb29waW5nQW5pbWF0aW9ucygpICYmXG4gICAgICAgICAgICAgIHRoaXMuX19pc0xvb3BpbmcgPT09IHRydWVcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE9uY2UgdGhlIEpTIHNpZGUgbm9kZSBpcyBzeW5jZWQgd2l0aCB0aGUgdXBkYXRlZCB2YWx1ZXMsIHRyaWdnZXIgYW5cbiAgICAgICAgICAgIC8vIHVwZGF0ZSBvbiB0aGUgQW5pbWF0ZWRQcm9wcyBub2RlcyB0byBjYWxsIGFueSByZWdpc3RlcmVkIGNhbGxiYWNrcy5cbiAgICAgICAgICAgIHRoaXMuX19maW5kQW5pbWF0ZWRQcm9wc05vZGVzKGFuaW1hdGVkVmFsdWUpLmZvckVhY2gobm9kZSA9PlxuICAgICAgICAgICAgICBub2RlLnVwZGF0ZSgpLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBlO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBOYXRpdmVBbmltYXRlZEhlbHBlci5BUEkudW5zZXRXYWl0aW5nRm9ySWRlbnRpZmllcihcbiAgICAgICAgc3RhcnROYXRpdmVBbmltYXRpb25XYWl0SWQsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBOb3RpZnkgdGhlIGNvbXBsZXRpb24gY2FsbGJhY2sgdGhhdCB0aGUgYW5pbWF0aW9uIGhhcyBlbmRlZC4gVGhlIGNvbXBsZXRpb25cbiAgICogY2FsbGJhY2sgd2lsbCBuZXZlciBiZSBjYWxsZWQgbW9yZSB0aGFuIG9uY2UuXG4gICAqL1xuICBfX25vdGlmeUFuaW1hdGlvbkVuZChyZXN1bHQ6IEVuZFJlc3VsdCk6IHZvaWQge1xuICAgIGNvbnN0IGNhbGxiYWNrID0gdGhpcy4jb25FbmQ7XG4gICAgaWYgKGNhbGxiYWNrICE9IG51bGwpIHtcbiAgICAgIHRoaXMuI29uRW5kID0gbnVsbDtcbiAgICAgIGNhbGxiYWNrKHJlc3VsdCk7XG4gICAgfVxuICB9XG5cbiAgX19nZXREZWJ1Z0lEKCk6ID9zdHJpbmcge1xuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICByZXR1cm4gdGhpcy5fX2RlYnVnSUQ7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQWNBLElBQUFBLHFCQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyx1QkFBQSxHQUFBQyx1QkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsY0FBQSxHQUFBSixzQkFBQSxDQUFBQyxPQUFBO0FBQW1ELFNBQUFJLHlCQUFBQyxDQUFBLDZCQUFBQyxPQUFBLG1CQUFBQyxDQUFBLE9BQUFELE9BQUEsSUFBQUUsQ0FBQSxPQUFBRixPQUFBLFlBQUFGLHdCQUFBLFlBQUFBLHlCQUFBQyxDQUFBLFdBQUFBLENBQUEsR0FBQUcsQ0FBQSxHQUFBRCxDQUFBLEtBQUFGLENBQUE7QUFBQSxTQUFBSCx3QkFBQUcsQ0FBQSxFQUFBRSxDQUFBLFNBQUFBLENBQUEsSUFBQUYsQ0FBQSxJQUFBQSxDQUFBLENBQUFJLFVBQUEsU0FBQUosQ0FBQSxlQUFBQSxDQUFBLHVCQUFBQSxDQUFBLHlCQUFBQSxDQUFBLFdBQUFLLE9BQUEsRUFBQUwsQ0FBQSxRQUFBRyxDQUFBLEdBQUFKLHdCQUFBLENBQUFHLENBQUEsT0FBQUMsQ0FBQSxJQUFBQSxDQUFBLENBQUFHLEdBQUEsQ0FBQU4sQ0FBQSxVQUFBRyxDQUFBLENBQUFJLEdBQUEsQ0FBQVAsQ0FBQSxPQUFBUSxDQUFBLEtBQUFDLFNBQUEsVUFBQUMsQ0FBQSxHQUFBQyxNQUFBLENBQUFDLGNBQUEsSUFBQUQsTUFBQSxDQUFBRSx3QkFBQSxXQUFBQyxDQUFBLElBQUFkLENBQUEsb0JBQUFjLENBQUEsT0FBQUMsY0FBQSxDQUFBQyxJQUFB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